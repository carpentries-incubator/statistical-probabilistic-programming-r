<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Introduction to Probabilistic Programming in R: exercises</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [ ['$','$'], ['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="manifest" href="../site.webmanifest"><link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"></head><body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav incubator"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Carpentries Incubator" src="../assets/images/incubator-logo.svg"><abbr class="icon" title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught." style="text-decoration: unset">
           
          <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link" style="color: #383838">Pre-Alpha
            <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="color: #FF4955; border-radius: 5px"></i>
          </a>
          <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
        </abbr>
        
      </div>
    </div>
    <div class="selector-container ">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../exercises.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Introduction to Probabilistic Programming in R
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
      <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Introduction to Probabilistic Programming in R
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"></ul></li>
      </ul></div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled><input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset></form>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Introduction to Probabilistic Programming in R
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 90%" class="percentage">
    90%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 90%" aria-valuenow="90" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
  <div id="sidebar-col" class="col-lg-4">
    <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle"><i class="search-icon" data-feather="x" role="img"></i></button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../exercises.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->
      
            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="setup.html">1. Setup</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="bayesian-statistics.html">2. Bayesian Statistics</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="sampling.html">3. Working with samples</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="stan.html">4. Stan</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="mcmc.html">5. MCMC</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="hierarchical-models.html">6. Hierarchical Models</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="model-critisism.html">7. Model checking</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="other-topics.html">8. Other topics</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="recommended-reading.html">9. further-materials</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        10. exercises
        </span>
      </button>
    </div><!--/div.accordion-header-->
        
    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#bayesian-statistics">Bayesian statistics</a></li>
<li><a href="#working-with-samples">Working with samples</a></li>
<li><a href="#stan">Stan</a></li>
<li><a href="#mcmc">MCMC</a></li>
<li><a href="#hierarchical-models">Hierarchical models</a></li>
<li><a href="#model-critisism">Model critisism</a></li>
<li><a href="#other-topics">Other topics</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="../instructor/aio.html">See all in one page</a>

            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">
            
            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/recommended-reading.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/index.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/recommended-reading.html" rel="prev"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous: further-materials</a>
        <a class="chapter-link float-end" href="../instructor/index.html" rel="next">Next... <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>exercises</h1>
        <p> Last updated on 2023-06-27 | 
        
        <a href="https://github.com/carpentries-incubator/statistical-probabilistic-programming-r/edit/main/episodes/exercises.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
        
        
        
        <p>Estimated time <i aria-hidden="true" data-feather="clock"></i> 12 minutes </p>
        
        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How can I get routine in probabilistic programming?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>The purpose of this episode is to provide material for practicing
probabilistic programming. The exercises are listed approximately based
on the episode they refer to.</p>
</div>
</div>
</div>
</div>
</div>
<section id="bayesian-statistics"><h2 class="section-heading">Bayesian statistics<a class="anchor" aria-label="anchor" href="#bayesian-statistics"></a>
</h2>
<hr class="half-width"><div class="section level3">
<h3 id="easy-explanation">(easy) Explanation<a class="anchor" aria-label="anchor" href="#easy-explanation"></a></h3>
<p>In your own words, explain the following concepts</p>
<ol style="list-style-type: decimal"><li>Posterior distribution</li>
<li>Informative prior distribution</li>
<li>Grid approximation</li>
<li>Effect of prior when different amount of data is available</li>
<li>Marginal posterior distribution</li>
</ol></div>
<div class="section level3">
<h3 id="easy-formula-explanations">(easy) Formula explanations<a class="anchor" aria-label="anchor" href="#easy-formula-explanations"></a></h3>
<p>For the models described by the following formulas, come up with
realistic scenarios where the models could be used.</p>
<ol style="list-style-type: decimal"><li><p><span class="math display">\[\begin{align}
y_i &amp; \sim Normal(\mu, \sigma) \\
\mu &amp; \sim Normal(0, 1) \\
\sigma &amp; \sim Exponential(1)
\end{align}\]</span></p></li>
<li><p><span class="math display">\[\begin{align}
y_i &amp; \sim Normal(\alpha + \beta x_i, \sigma) \\
\alpha &amp; \sim Normal(0, 10) \\
\beta &amp; \sim Normal(0, 1) \\
\sigma &amp; \sim Exponential(1)
\end{align}\]</span></p></li>
</ol><p>Formulate statistical models for the following scenarios. Give
rationalizations for the likelihood and priors.</p>
<ol style="list-style-type: decimal"><li><p>A batch of 10000 avocados is shipped from South America to North
Europe. You’d like to estimate the proportion of the batch that doesn’t
get bad in transit.</p></li>
<li><p>A dart-throwing robot is poorly calibrated. Its throws produce a
dense, normally distributed cluster with an approximately identity
covariance matrix. However, the throws seems to veer down and left from
bull’s eye. You want the calibrate the robot based on a set of previous
throws.</p></li>
</ol><p>Provide examples not found in the course material.</p>
</div>
<div class="section level3">
<h3 id="easy-formula-explanations-2">(easy) Formula explanations 2<a class="anchor" aria-label="anchor" href="#easy-formula-explanations-2"></a></h3>
<p>What prior distributions would you use for the following parameters?
Justify your choices.</p>
<ol style="list-style-type: decimal"><li>Life expectancy in the developed world</li>
<li>The probability of a successful 3 point basketball throw (for
yourself)</li>
<li>The regression coefficient for milage per liter of gas and car
weight</li>
<li>The waiting time for a government bureau helpline</li>
<li>The effect of national energy drink consumption on yearly
rainfall</li>
</ol></div>
<div class="section level3">
<h3 id="medium-analyze-grid-approximation">(medium) Analyze grid approximation<a class="anchor" aria-label="anchor" href="#medium-analyze-grid-approximation"></a></h3>
<p>In Cox regression, the risk for an event (such as the onset of a
disease) can be estimated based on follow-up data and background
variables at the beginning of the study. Assume the effect of a cancer
medicine is studied in control and treatment groups. The data frame
below gives the posterior distribution for the effect size <span class="math inline">\(\beta\)</span> of the medicine on survival
compared to the control group. What assumptions were made in the
analysis that most likely will produce incorrect conclusions about the
efficacy of the drug?</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span></span>
<span>  beta <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="op">-</span><span class="fl">0.25</span>, <span class="op">-</span><span class="fl">0.219</span>, <span class="op">-</span><span class="fl">0.188</span>, <span class="op">-</span><span class="fl">0.156</span>, <span class="op">-</span><span class="fl">0.125</span>, <span class="op">-</span><span class="fl">0.094</span>, <span class="op">-</span><span class="fl">0.062</span>, <span class="op">-</span><span class="fl">0.031</span>, <span class="fl">0</span>, <span class="fl">0.031</span>, <span class="fl">0.062</span>, <span class="fl">0.094</span>, <span class="fl">0.125</span>, <span class="fl">0.156</span>, <span class="fl">0.188</span>, <span class="fl">0.219</span>, <span class="fl">0.25</span>, <span class="fl">0.281</span>, <span class="fl">0.312</span>, <span class="fl">0.344</span>, <span class="fl">0.375</span>, <span class="fl">0.406</span>, <span class="fl">0.438</span>, <span class="fl">0.469</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  posterior <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1.052</span>, <span class="fl">1.478</span>, <span class="fl">2.025</span>, <span class="fl">2.707</span>, <span class="fl">3.533</span>, <span class="fl">4.498</span>, <span class="fl">5.59</span>, <span class="fl">6.779</span>, <span class="fl">8.023</span>, <span class="fl">9.266</span>, <span class="fl">10.444</span>, <span class="fl">11.487</span>, <span class="fl">12.33</span>, <span class="fl">12.915</span>, <span class="fl">13.202</span>, <span class="fl">13.17</span>, <span class="fl">12.821</span>, <span class="fl">12.18</span>, <span class="fl">11.293</span>, <span class="fl">10.217</span>, <span class="fl">9.021</span>, <span class="fl">7.773</span>, <span class="fl">6.536</span>, <span class="fl">5.363</span>, <span class="fl">4.295</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="medium-grid-approximation-for-the-linear-model">(medium) Grid approximation for the linear model<a class="anchor" aria-label="anchor" href="#medium-grid-approximation-for-the-linear-model"></a></h3>
<p>On the planet Neptunus, a ball is dropped from <span class="math inline">\(h=8\)</span> meters <span class="math inline">\(N=25\)</span> times and the falling time <span class="math inline">\(t\)</span> is measured for each drop. From
previous experiments, it is known that the measurement error is normally
distributed with standard deviation of 0.2. The measurement times are as
follows.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Time</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1.28</span>, <span class="fl">1.18</span>, <span class="fl">1.37</span>, <span class="fl">1.17</span>, <span class="fl">0.98</span>, <span class="fl">1.02</span>,</span>
<span>          <span class="fl">1.16</span>, <span class="fl">1.19</span>, <span class="fl">1.55</span>, <span class="fl">1.13</span>, <span class="fl">1.57</span>, <span class="fl">1.26</span>,</span>
<span>          <span class="fl">1.39</span>, <span class="fl">1.1</span>, <span class="fl">1.4</span>, <span class="fl">0.92</span>, <span class="fl">1.15</span>, <span class="fl">1.19</span>, <span class="fl">1.25</span>,</span>
<span>          <span class="fl">1.01</span>, <span class="fl">0.82</span>, <span class="fl">1.46</span>, <span class="fl">1.06</span>, <span class="fl">1.38</span>, <span class="fl">1.24</span><span class="op">)</span></span></code></pre>
</div>
<p>According to Newton’s theory of gravity, <span class="math inline">\(h\)</span> and <span class="math inline">\(t\)</span> are connected via the relation of <span class="math inline">\(h = \frac{1}{2}gt^2\)</span>, where <span class="math inline">\(g\)</span> is the gravitational constant.</p>
<p>Implement the grid approximation for standard linear regression and
estimate <span class="math inline">\(g\)</span>. Give the posterior mode
and 90% CIs. Use some reasonable prior distribution.</p>
<div class="section level4">
<h4 id="hint">Hint<a class="anchor" aria-label="anchor" href="#hint"></a></h4>
<p>Solve formula <span class="math inline">\(h =
\frac{1}{2}gt^2\)</span> for <span class="math inline">\(t\)</span> so
the model error measures time measurement error. Further, do a parameter
transformation so the formula doesn’t contain squares of variables.</p>
</div>
</div>
</section><section id="working-with-samples"><h2 class="section-heading">Working with samples<a class="anchor" aria-label="anchor" href="#working-with-samples"></a>
</h2>
<hr class="half-width"><div class="section level3">
<h3 id="easy-sampling-the-posterior">(easy) Sampling the posterior<a class="anchor" aria-label="anchor" href="#easy-sampling-the-posterior"></a></h3>
<p>Assume we model the following observations <span class="math inline">\(X\)</span> with the exponential likelihood:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0.166</span>, <span class="fl">1.08</span>, <span class="fl">1.875</span>, <span class="fl">0.413</span>, <span class="fl">1.369</span>, <span class="fl">0.463</span>, <span class="fl">0.735</span>,</span>
<span>       <span class="fl">0.24</span>, <span class="fl">0.774</span>, <span class="fl">1.09</span>, <span class="fl">0.463</span>, <span class="fl">0.916</span>, <span class="fl">0.225</span>, <span class="fl">0.889</span>,</span>
<span>       <span class="fl">0.051</span>, <span class="fl">0.688</span>, <span class="fl">0.119</span>, <span class="fl">0.078</span>, <span class="fl">1.624</span>, <span class="fl">0.553</span>, <span class="fl">0.523</span>,</span>
<span>       <span class="fl">0.644</span>, <span class="fl">0.284</span>, <span class="fl">1.744</span>, <span class="fl">1.468</span><span class="op">)</span></span></code></pre>
</div>
<p>If we add a <span class="math inline">\(\Gamma(2, 1)\)</span> prior,
the posterior distribution can be shown to be</p>
<p><span class="math display">\[p(\lambda | X) = \Gamma(2 + n, 1 +
\sum_{i}^{n}X_i),\]</span> where <span class="math inline">\(n\)</span>
is the number of observations.</p>
<p>Produce 1000 samples from the posterior and compute 1. posterior mean
and mode 2. 50%, 90% and 95% posterior intervals 3. the probabilities
that <span class="math inline">\(\lambda &gt; 1\)</span>, <span class="math inline">\(\lambda &lt; 1.5\)</span>, and <span class="math inline">\(1&lt;\lambda&lt;1.5\)</span></p>
</div>
<div class="section level3">
<h3 id="easy-marginal-posterior">(easy) Marginal posterior<a class="anchor" aria-label="anchor" href="#easy-marginal-posterior"></a></h3>
<p>Suppose the following piece of code produces samples from a
(bivariate) posterior for <span class="math inline">\(\theta =
(\theta_1, \theta_2).\)</span></p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posterior_samples</span> <span class="op">&lt;-</span> <span class="fu">mvtnorm</span><span class="fu">::</span><span class="fu">rmvnorm</span><span class="op">(</span><span class="fl">1000</span>,</span>
<span>                                      mean <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>                                      sigma <span class="op">=</span> <span class="fu">matrix</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.65</span>, <span class="fl">0.65</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make into a data frame</span></span>
<span><span class="va">posterior_samples</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span><span class="va">posterior_samples</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_colnames</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"theta1"</span>, <span class="st">"theta2"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Produce marginal posterior samples for <span class="math inline">\(\theta_1\)</span> and <span class="math inline">\(\theta_2\)</span>. Plot the full and marginal
posteriors. What information is lost if you only look at the marginal
posteriors?</p>
</div>
<div class="section level3">
<h3 id="medium-posterior-of-difference">(medium) Posterior of difference<a class="anchor" aria-label="anchor" href="#medium-posterior-of-difference"></a></h3>
<p>Consider the posterior distribution of the previous exercise. What is
the probability that <span class="math inline">\(\theta_1\)</span> is
larger than <span class="math inline">\(\theta_2\)</span>?</p>
</div>
<div class="section level3">
<h3 id="medium-sample-size-estimation">(medium) Sample size estimation<a class="anchor" aria-label="anchor" href="#medium-sample-size-estimation"></a></h3>
<p>Suppose we aim to estimate p, the proportion of left-handed people
very precisely (assume true p = 0.094). Specifically, we want the 99%
percentile interval of the posterior distribution of p to be only 0.05
wide. Approximately how large of a study sample do we need? Simulate, no
need to do analytical calculations. Use a prior of your liking.</p>
</div>
<div class="section level3">
<h3 id="medium-less-data-means-bigger-prior-effect">(medium) Less data means bigger prior effect<a class="anchor" aria-label="anchor" href="#medium-less-data-means-bigger-prior-effect"></a></h3>
<p>Explore the effec of sample size on the location and variance of the
posterior.</p>
<p>Instructions: - Set p ~ (0, 1) and generate data from the binomial
model. Simulate a sequence of 200 throws. - Draw samples form the the
analytical posterior using the first 5, 10, 15,…, 200 throws - Compute
the posterior mode and 90% CIs for each fit - Visualize the results by
generating a figure with: - the mode and CIs as the function of data
size - true parameter value - prior mode and CIs. - Check formulas
e.g. from Wikipedia - true analytical posterior mode and CIs using all
200 throws</p>
</div>
<div class="section level3">
<h3 id="hard-highest-posterior-density-set">(hard) Highest posterior density set<a class="anchor" aria-label="anchor" href="#hard-highest-posterior-density-set"></a></h3>
<p>Assume the following piece of code generates 5000 samples from a
posterior distribution.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posterior_samples</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fu">rnorm</span><span class="op">(</span><span class="fl">2500</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fu">rnorm</span><span class="op">(</span><span class="fl">2500</span>, <span class="fl">1</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Compute the 50% highest posterior density set (not necessarily an
interval!) of this distribution. Plot the set over a histogram of the
samples.</p>
<div class="section level4">
<h4 id="hint-1">Hint<a class="anchor" aria-label="anchor" href="#hint-1"></a></h4>
<ul><li>Generate the posterior density from the samples with the
<code>density</code> function.</li>
<li>Starting from the highest density, scan the density values in a
decreasing order. Determine the mass of the posterior corresponding to
the posterior above the particular density values. What does this set
represent?</li>
</ul></div>
</div>
</section><section id="stan"><h2 class="section-heading">Stan<a class="anchor" aria-label="anchor" href="#stan"></a>
</h2>
<hr class="half-width"><div class="section level3">
<h3 id="easy-analyze-stan-programs">(easy) Analyze Stan programs<a class="anchor" aria-label="anchor" href="#easy-analyze-stan-programs"></a></h3>
<p>Write the statistical models implemented in the following Stan
programs and give some explanation on what they model.</p>
<ol style="list-style-type: decimal"><li>
</li></ol><div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">STAN<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode stan" tabindex="0"><code class="sourceCode stan"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span>{</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; N;</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] X;</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> mu;</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; tau;</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  X ~ normal(mu, <span class="dv">1</span>/tau);</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  mu ~ normal(<span class="dv">0</span>, <span class="dv">10</span>);</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  tau ~ Gamma(<span class="dv">2</span>, <span class="dv">1</span>);</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre>
</div>
<ol start="2" style="list-style-type: decimal"><li>
</li></ol><div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">STAN<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode stan" tabindex="0"><code class="sourceCode stan"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span>{</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; N;</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] X;</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[<span class="dv">3</span>] phi;</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma;</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">3</span>:N) {</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    X[i] ~ normal(phi[<span class="dv">1</span>] + phi[<span class="dv">2</span>]*X[i<span class="dv">-1</span>] + phi[<span class="dv">3</span>]*X[i<span class="dv">-2</span>], sigma);</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  phi ~ normal(<span class="dv">0</span>, <span class="dv">1</span>);</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre>
</div>
<ol start="3" style="list-style-type: decimal"><li>
</li></ol><div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">STAN<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode stan" tabindex="0"><code class="sourceCode stan"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span>{</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; n_groups;</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[n_groups] X;</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; N;</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[n_groups] theta;</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(g <span class="cf">in</span> n_groups) {</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    X[g] ~ binomial(N, theta[g]);</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  theta ~ beta(alpha, beta);</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  alpha ~ gamma(<span class="dv">2</span>, <span class="fl">0.1</span>); </span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  beta ~ gamma(<span class="dv">2</span>, <span class="fl">0.1</span>);</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="easy-complete-stan-program">(easy) Complete Stan program<a class="anchor" aria-label="anchor" href="#easy-complete-stan-program"></a></h3>
<p>Fill the following Stan program for logistic regression</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">logistic_model</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">  data {</span></span>
<span><span class="st">    vector x;</span></span>
<span><span class="st">    int&lt;lower=0,upper=1&gt; y;</span></span>
<span><span class="st">  }</span></span>
<span><span class="st">  parameters {</span></span>
<span><span class="st">    alpha;</span></span>
<span><span class="st">    beta;</span></span>
<span><span class="st">  }</span></span>
<span><span class="st">  model {</span></span>
<span><span class="st">    y ~ bernoulli_logit(alpha + beta * x);</span></span>
<span><span class="st">    </span></span>
<span><span class="st">    alpha ~ ;</span></span>
<span><span class="st">    beta ~ ;</span></span>
<span><span class="st">  }</span></span>
<span><span class="st">"</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="medium-estimate-dice-fairness">(medium) Estimate dice fairness<a class="anchor" aria-label="anchor" href="#medium-estimate-dice-fairness"></a></h3>
<p>Estimate the fairness of a 6 sided dice, that is, the probabilities
of getting each face on a random roll. The results from 99 rolls is
stored in the vector <code>rolls</code>.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rolls</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">4</span>,</span>
<span>           <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">6</span>, <span class="fl">5</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">3</span>,</span>
<span>           <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">5</span>,</span>
<span>           <span class="fl">5</span>, <span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">6</span>, <span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">4</span>,</span>
<span>           <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">6</span>, <span class="fl">5</span>, <span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">4</span>,</span>
<span>           <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">5</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span>,</span>
<span>           <span class="fl">5</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">6</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">5</span>,</span>
<span>           <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<p>Write a Stan program that implements the following statistical
model:</p>
<p><span class="math display">\[\begin{align}
y &amp; \sim categorial(\theta) \\
\theta &amp; \sim Dir(\textbf{1}),
\end{align}\]</span></p>
<p>Where <span class="math inline">\(Dir\)</span> is the Dirichlet
distribution with parameter <span class="math inline">\(\alpha = 1, 1,
\ldots, 1.\)</span> Plot the marginal posteriors for each <span class="math inline">\(\theta_i\)</span>. Is the dice fair? Quantify
this: give some probability for the hypothesis “the dice is fair” (for
example, compute the probability of for <span class="math inline">\(\theta_i &gt; \theta_j\)</span> for some <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>).</p>
</div>
<div class="section level3">
<h3 id="medium-basketbass-throws">(medium) Basketbass throws<a class="anchor" aria-label="anchor" href="#medium-basketbass-throws"></a></h3>
<p>Implement Beta regression in Stan that assumes data is generated from
a Beta(a, b) where a, b unknown parameters.</p>
<p>Use the program to analyze basketball free throw accuracy in the NBA
based on a sample of <span class="math inline">\(N=20\)</span> players.
Generate the posterior predictive distribution and compare to the full
data.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Data</span></span>
<span></span>
<span><span class="co"># Data from https://www.kaggle.com/datasets/nicklauskim/nba-per-game-stats-201920?resource=download&amp;select=nba_2020_advanced.csv</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/basketball.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Rows: 651 Columns: 26
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (3): Player, Pos, Tm
dbl (23): Age, G, MP, PER, TS%, 3PAr, FTr, ORB%, DRB%, TRB%, AST%, STL%, BLK...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span></span>
<span><span class="co"># remove NAS and 0, 1</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">FTr</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">FTr</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">FTr</span> <span class="op">&lt;</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Choose random sample</span></span>
<span><span class="va">df_sample</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu">sample</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu">nrow</span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, <span class="va">N</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, <span class="op">]</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="medium-posteriorprior-predictive-check">(medium) Posterior/prior predictive check<a class="anchor" aria-label="anchor" href="#medium-posteriorprior-predictive-check"></a></h3>
<p>Consider linear regression with one dependent variable implemented in
the Stan program:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">STAN<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode stan" tabindex="0"><code class="sourceCode stan"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; N; <span class="co">// Sample size</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] x; <span class="co">// x-values</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] y; <span class="co">// y-values</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> alpha; <span class="co">// intercept</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> beta;  <span class="co">// slope</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma; <span class="co">// noise</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Likelihood</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  y ~ normal(alpha + beta * x, sigma);</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Priors</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  alpha ~ normal(<span class="dv">0</span>, <span class="dv">1</span>);</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  beta ~ normal(<span class="dv">0</span>, <span class="dv">1</span>);</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  sigma ~ gamma(<span class="dv">2</span>, <span class="dv">1</span>);</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>}</span></code></pre>
</div>
<p>and the following data:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="op">-</span><span class="fl">1.61</span>, <span class="fl">1.55</span>, <span class="op">-</span><span class="fl">0.14</span>, <span class="fl">0.27</span>, <span class="op">-</span><span class="fl">1.64</span>, <span class="fl">0.61</span>, <span class="op">-</span><span class="fl">0.17</span>, <span class="fl">1.56</span>, <span class="op">-</span><span class="fl">0.96</span>, <span class="fl">1.33</span>, <span class="fl">1.72</span>, <span class="fl">1.76</span>, <span class="fl">1.49</span>, <span class="op">-</span><span class="fl">1.55</span>, <span class="fl">0.69</span>, <span class="op">-</span><span class="fl">1.39</span>, <span class="fl">1.28</span>, <span class="fl">0.63</span>, <span class="op">-</span><span class="fl">0.96</span>, <span class="fl">0.13</span>, <span class="op">-</span><span class="fl">1.33</span>, <span class="fl">1.07</span>, <span class="fl">1.01</span>, <span class="op">-</span><span class="fl">1.94</span>, <span class="fl">1.2</span>, <span class="fl">0.36</span>, <span class="fl">1.38</span>, <span class="fl">0.08</span>, <span class="fl">1.47</span>, <span class="fl">0.32</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="op">-</span><span class="fl">1.84</span>, <span class="fl">2.06</span>, <span class="fl">0.41</span>, <span class="fl">1.09</span>, <span class="op">-</span><span class="fl">2.3</span>, <span class="fl">1.22</span>, <span class="fl">2.02</span>, <span class="fl">4.03</span>, <span class="fl">0.52</span>, <span class="fl">2.76</span>, <span class="fl">3.66</span>, <span class="fl">0.43</span>, <span class="fl">4.62</span>, <span class="op">-</span><span class="fl">0.03</span>, <span class="fl">0.16</span>, <span class="op">-</span><span class="fl">0.1</span>, <span class="fl">2.82</span>, <span class="fl">1.63</span>, <span class="op">-</span><span class="fl">0.35</span>, <span class="fl">0.89</span>, <span class="fl">0.29</span>, <span class="fl">0.78</span>, <span class="fl">1.9</span>, <span class="fl">0.26</span>, <span class="fl">0.84</span>, <span class="fl">1.06</span>, <span class="fl">2.93</span>, <span class="fl">3.38</span>, <span class="fl">2.44</span>, <span class="fl">2.48</span><span class="op">)</span></span>
<span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fl">0.75</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></code></pre>
</div>
<p>Use Stan to do the following:</p>
<ol style="list-style-type: decimal"><li>Posterior predictive check (for same data):</li>
</ol><ol style="list-style-type: lower-alpha"><li>Simulate output data (response variable y) from the posterior for
the same input data (predictor variable x).</li>
<li>Compare the simulated and original responses that were used for
model inference. There are many possible ways to compare original and
simulated y, propose your own solution.</li>
</ol><p>Tip: Stan manual page on posterior predictive distribution: <a href="https://mc-stan.org/docs/stan-users-guide/simulating-from-the-posterior-predictive-distribution.html" class="external-link uri">https://mc-stan.org/docs/stan-users-guide/simulating-from-the-posterior-predictive-distribution.html</a></p>
<ol start="2" style="list-style-type: decimal"><li>Posterior predictions (for new data):</li>
</ol><ol style="list-style-type: lower-alpha"><li>Simulate data from the posterior of the linear model for new
(different) input data (x_new).</li>
<li>Compare the simulated and original responses that were used for
model inference. There are many possible ways to compare original and
simulated y, propose your own solution.</li>
</ol><ol start="3" style="list-style-type: decimal"><li>Prior predictive checks:</li>
</ol><ol style="list-style-type: lower-alpha"><li>Generate samples (for y) from the prior predictive
distribution.</li>
<li>Compare prior and posterior simulations for y; try both informative
and uninformative priors; is there any difference?</li>
</ol><p>Tip: note that this can be implented in Stan but you do not
necessarily need Stan to draw samples from the prior distribution.</p>
</div>
<div class="section level3">
<h3 id="hard-write-stan-program-oup">(hard) Write Stan program: OUP<a class="anchor" aria-label="anchor" href="#hard-write-stan-program-oup"></a></h3>
<p>The Ornstein-Uhlenbeck process (OUP) can be used (among other things)
as a part in algorithmic trading strategies. The model is a stochastic
differential equation defined as</p>
<p><span class="math display">\[dX_t = \phi(\mu - X_t) + \sigma
dW,\]</span> where <span class="math inline">\(X_t\)</span> is the state
variable at time <span class="math inline">\(t\)</span>, <span class="math inline">\(\mu\)</span> is the mean level, <span class="math inline">\(\phi\)</span> the mean-reversion rate, and <span class="math inline">\(\sigma\)</span> determines the level of stochastic
variations of the process. <span class="math inline">\(dW\)</span> is a
so-called Wiener process, of which you can read more about elsewhere.
The parameter <span class="math inline">\(\phi\)</span> determines how
quickly the process returns towards <span class="math inline">\(\mu\)</span> if the system is driven away from
<span class="math inline">\(\mu.\)</span></p>
<p>The nice thing about the OUP is that it is analytically tractable,
meaning that the transition density between different time points is
known. In other words, <span class="math inline">\(p(X_{t + dt} | X_t) =
N(\mu - (\mu - X_t)e^{-\lambda t}, \frac{\sigma^2}{2\phi}(1-e^{-2\phi
t})).\)</span> This allows writing the likelihood for the data!</p>
<p>Implement the OUP in Stan and fit it on the data provided below. The
data is the daily stock price of Exxon Mobil over the past 2 years
(minus the 20 day exponential moving average, provided by Yahoo). Plot
the posteriors of the model parameters. How could you use the analysis
to make trading decisions (this is not an investment
recommendation)?</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exxon</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="op">-</span><span class="fl">6.71</span>, <span class="op">-</span><span class="fl">8.31</span>, <span class="op">-</span><span class="fl">5.79</span>, <span class="op">-</span><span class="fl">7.72</span>, <span class="op">-</span><span class="fl">8.37</span>, <span class="op">-</span><span class="fl">5.16</span>, <span class="op">-</span><span class="fl">4.55</span>, <span class="op">-</span><span class="fl">4.51</span>, <span class="op">-</span><span class="fl">5.11</span>, <span class="op">-</span><span class="fl">4.32</span>, <span class="op">-</span><span class="fl">5.45</span>, <span class="op">-</span><span class="fl">3.66</span>, <span class="op">-</span><span class="fl">1.9</span>, <span class="fl">0.24</span>, <span class="fl">1.1</span>, <span class="op">-</span><span class="fl">0.35</span>, <span class="op">-</span><span class="fl">0.93</span>, <span class="fl">1.79</span>, <span class="fl">1.3</span>, <span class="fl">2.93</span>, <span class="fl">3.62</span>, <span class="fl">7.16</span>, <span class="fl">4.26</span>, <span class="fl">3.48</span>, <span class="fl">0.39</span>, <span class="op">-</span><span class="fl">3.11</span>, <span class="op">-</span><span class="fl">1.68</span>, <span class="op">-</span><span class="fl">1.06</span>, <span class="fl">0.52</span>, <span class="fl">1.25</span>, <span class="fl">2.71</span>, <span class="fl">3.18</span>, <span class="fl">1.36</span>, <span class="fl">0.45</span>, <span class="fl">1.08</span>, <span class="fl">2.95</span>, <span class="fl">2.39</span>, <span class="fl">2.1</span>, <span class="fl">5.51</span>, <span class="fl">5.51</span>, <span class="fl">5.45</span>, <span class="fl">3.83</span>, <span class="fl">5.5</span>, <span class="fl">1.53</span>, <span class="fl">0.73</span>, <span class="op">-</span><span class="fl">0.9</span>, <span class="fl">0.75</span>, <span class="fl">0.1</span>, <span class="op">-</span><span class="fl">0.65</span>, <span class="fl">0.11</span>, <span class="fl">1.54</span>, <span class="fl">2.4</span>, <span class="fl">0.11</span>, <span class="fl">2.21</span>, <span class="op">-</span><span class="fl">0.57</span>, <span class="op">-</span><span class="fl">1.98</span>, <span class="op">-</span><span class="fl">1.8</span>, <span class="op">-</span><span class="fl">2.32</span>, <span class="op">-</span><span class="fl">3.44</span>, <span class="op">-</span><span class="fl">3.46</span>, <span class="op">-</span><span class="fl">7.49</span>, <span class="op">-</span><span class="fl">8.38</span>, <span class="op">-</span><span class="fl">5.99</span>, <span class="op">-</span><span class="fl">2.6</span>, <span class="op">-</span><span class="fl">2.51</span>, <span class="op">-</span><span class="fl">3.51</span>, <span class="fl">0.99</span>, <span class="fl">3.93</span>, <span class="fl">7.04</span>, <span class="fl">9.03</span>, <span class="fl">7.24</span>, <span class="fl">4.57</span>, <span class="fl">3.37</span>, <span class="fl">3.44</span>, <span class="fl">6.22</span>, <span class="fl">3.21</span>, <span class="fl">4.2</span>, <span class="fl">3.96</span>, <span class="fl">6.29</span>, <span class="fl">5.81</span>, <span class="fl">7.01</span>, <span class="fl">7.01</span>, <span class="fl">5.69</span>, <span class="fl">6.29</span>, <span class="fl">6.06</span>, <span class="fl">8.33</span>, <span class="fl">7.64</span>, <span class="fl">7.91</span>, <span class="fl">5.07</span>, <span class="fl">5.94</span>, <span class="fl">6.47</span>, <span class="fl">7.05</span>, <span class="fl">6.71</span>, <span class="fl">1.46</span>, <span class="fl">2.76</span>, <span class="fl">5.62</span>, <span class="fl">4.56</span>, <span class="fl">4.82</span>, <span class="fl">3.25</span>, <span class="fl">3.08</span>, <span class="fl">1.9</span>, <span class="fl">0.71</span>, <span class="fl">3.55</span>, <span class="fl">2.7</span>, <span class="fl">2.08</span>, <span class="op">-</span><span class="fl">1.2</span>, <span class="op">-</span><span class="fl">0.42</span>, <span class="fl">0.34</span>, <span class="op">-</span><span class="fl">0.18</span>, <span class="op">-</span><span class="fl">1.01</span>, <span class="op">-</span><span class="fl">3.64</span>, <span class="op">-</span><span class="fl">5.98</span>, <span class="op">-</span><span class="fl">5.62</span>, <span class="op">-</span><span class="fl">4.39</span>, <span class="op">-</span><span class="fl">4.77</span>, <span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">0.76</span>, <span class="op">-</span><span class="fl">1.41</span>, <span class="op">-</span><span class="fl">2.19</span>, <span class="op">-</span><span class="fl">2.66</span>, <span class="op">-</span><span class="fl">1.98</span>, <span class="op">-</span><span class="fl">0.41</span>, <span class="fl">0.87</span>, <span class="op">-</span><span class="fl">1.19</span>, <span class="fl">1.46</span>, <span class="fl">2.68</span>, <span class="fl">0.79</span>, <span class="fl">1.46</span>, <span class="fl">2.31</span>, <span class="op">-</span><span class="fl">1.34</span>, <span class="op">-</span><span class="fl">0.93</span>, <span class="fl">1.32</span>, <span class="fl">2.39</span>, <span class="fl">0.3</span>, <span class="fl">1.74</span>, <span class="fl">2.73</span>, <span class="fl">4.14</span>, <span class="fl">3.69</span>, <span class="fl">3.14</span>, <span class="fl">0.74</span>, <span class="fl">1.31</span>, <span class="fl">3.02</span>, <span class="fl">2.2</span>, <span class="fl">2.94</span>, <span class="fl">2.12</span>, <span class="fl">6.03</span>, <span class="fl">3.51</span>, <span class="fl">1.32</span>, <span class="fl">3.41</span>, <span class="fl">1.94</span>, <span class="op">-</span><span class="fl">1.49</span>, <span class="op">-</span><span class="fl">0.65</span>, <span class="op">-</span><span class="fl">0.76</span>, <span class="fl">2.2</span>, <span class="fl">1.08</span>, <span class="fl">1.37</span>, <span class="fl">5.6</span>, <span class="fl">3.83</span>, <span class="fl">2.21</span>, <span class="fl">1.69</span>, <span class="fl">1.22</span>, <span class="op">-</span><span class="fl">2.92</span>, <span class="op">-</span><span class="fl">2.75</span>, <span class="op">-</span><span class="fl">3.79</span>, <span class="op">-</span><span class="fl">2.51</span>, <span class="op">-</span><span class="fl">2.26</span>, <span class="op">-</span><span class="fl">2.23</span>, <span class="op">-</span><span class="fl">2.6</span>, <span class="op">-</span><span class="fl">1.46</span>, <span class="op">-</span><span class="fl">0.86</span>, <span class="fl">0.5</span>, <span class="fl">1.35</span>, <span class="op">-</span><span class="fl">0.77</span>, <span class="op">-</span><span class="fl">2.17</span>, <span class="op">-</span><span class="fl">2.73</span>, <span class="op">-</span><span class="fl">3.69</span>, <span class="op">-</span><span class="fl">4.46</span>, <span class="op">-</span><span class="fl">3.68</span>, <span class="op">-</span><span class="fl">8.14</span>, <span class="op">-</span><span class="fl">7.9</span>, <span class="op">-</span><span class="fl">8.22</span>, <span class="op">-</span><span class="fl">5.08</span>, <span class="op">-</span><span class="fl">0.44</span>, <span class="op">-</span><span class="fl">2.62</span>, <span class="op">-</span><span class="fl">3.43</span>, <span class="op">-</span><span class="fl">3</span>, <span class="op">-</span><span class="fl">0.66</span>, <span class="fl">0.6</span>, <span class="fl">2.21</span>, <span class="fl">2.48</span>, <span class="fl">2.39</span>, <span class="fl">8.02</span>, <span class="fl">6.25</span>, <span class="fl">7.44</span>, <span class="fl">4.97</span>, <span class="fl">4.04</span>, <span class="fl">4.39</span>, <span class="fl">3.86</span>, <span class="fl">3.98</span>, <span class="fl">3.86</span>, <span class="fl">2.27</span>, <span class="fl">4.08</span>, <span class="fl">3.35</span>, <span class="fl">2.19</span>, <span class="fl">2.32</span>, <span class="fl">4.08</span>, <span class="fl">2.17</span>, <span class="fl">1</span>, <span class="fl">2.15</span>, <span class="fl">3.31</span>, <span class="op">-</span><span class="fl">0.32</span>, <span class="op">-</span><span class="fl">4.43</span>, <span class="op">-</span><span class="fl">5.97</span>, <span class="op">-</span><span class="fl">7.11</span>, <span class="op">-</span><span class="fl">4.05</span>, <span class="op">-</span><span class="fl">3.27</span>, <span class="op">-</span><span class="fl">2.93</span>, <span class="op">-</span><span class="fl">3.92</span>, <span class="op">-</span><span class="fl">5.31</span>, <span class="op">-</span><span class="fl">4.81</span>, <span class="op">-</span><span class="fl">5</span>, <span class="op">-</span><span class="fl">6.83</span>, <span class="op">-</span><span class="fl">4.1</span>, <span class="op">-</span><span class="fl">2.85</span>, <span class="op">-</span><span class="fl">2.13</span>, <span class="op">-</span><span class="fl">3.1</span>, <span class="op">-</span><span class="fl">1.51</span>, <span class="op">-</span><span class="fl">0.29</span>, <span class="op">-</span><span class="fl">2.01</span>, <span class="op">-</span><span class="fl">2.44</span>, <span class="op">-</span><span class="fl">3.05</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="hard-implement-logistic-growth">(hard) Implement logistic growth<a class="anchor" aria-label="anchor" href="#hard-implement-logistic-growth"></a></h3>
<p>In ecology, evolution of population size is often modeled using
logistic growth which is defined by the differential equation</p>
<p><span class="math display">\[\frac{dP}{dt} =
rP(1-\frac{P}{K}),\]</span> where <span class="math inline">\(P\)</span>
is the population size, <span class="math inline">\(t\)</span> time,
<span class="math inline">\(r\)</span> the growth rate. The carrying
capacity <span class="math inline">\(K\)</span> determines the maximum
size of the population, and without it the population would grow
exponentially. The solution to this differential equation is</p>
<p><span class="math display">\[P(t) = \frac{K}{1 + (\frac{K}{P_0} -
1)e^{-rt}}.\]</span> In other words, the solution gives the population
size at time <span class="math inline">\(t\)</span>, given the initial
size <span class="math inline">\(P_0\)</span> and the model
parameters.</p>
<p>The following data contains (noisy and scaled) measurements of an
<strong>E. coli</strong> bacteria culture measured for 1 day
(Sprouffske, Wagner, Growthcurver (2016): an R package for obtaining
interpretable metrics from microbial growth curves (2016)).</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">E.coli</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span></span>
<span>  time <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.167</span>, <span class="fl">0.333</span>, <span class="fl">0.5</span>, <span class="fl">0.667</span>, <span class="fl">0.833</span>, <span class="fl">1</span>, <span class="fl">1.167</span>, <span class="fl">1.333</span>, <span class="fl">1.5</span>, <span class="fl">1.667</span>, <span class="fl">1.833</span>, <span class="fl">2</span>, <span class="fl">2.167</span>, <span class="fl">2.333</span>, <span class="fl">2.5</span>, <span class="fl">2.667</span>, <span class="fl">2.833</span>, <span class="fl">3</span>, <span class="fl">3.167</span>, <span class="fl">3.333</span>, <span class="fl">3.5</span>, <span class="fl">3.667</span>, <span class="fl">3.833</span>, <span class="fl">4</span>, <span class="fl">4.167</span>, <span class="fl">4.333</span>, <span class="fl">4.5</span>, <span class="fl">4.667</span>, <span class="fl">4.833</span>, <span class="fl">5</span>, <span class="fl">5.167</span>, <span class="fl">5.333</span>, <span class="fl">5.5</span>, <span class="fl">5.667</span>, <span class="fl">5.833</span>, <span class="fl">6</span>, <span class="fl">6.167</span>, <span class="fl">6.333</span>, <span class="fl">6.5</span>, <span class="fl">6.667</span>, <span class="fl">6.833</span>, <span class="fl">7</span>, <span class="fl">7.167</span>, <span class="fl">7.333</span>, <span class="fl">7.5</span>, <span class="fl">7.667</span>, <span class="fl">7.833</span>, <span class="fl">8</span>, <span class="fl">8.167</span>, <span class="fl">8.333</span>, <span class="fl">8.5</span>, <span class="fl">8.667</span>, <span class="fl">8.833</span>, <span class="fl">9</span>, <span class="fl">9.167</span>, <span class="fl">9.333</span>, <span class="fl">9.5</span>, <span class="fl">9.667</span>, <span class="fl">9.833</span>, <span class="fl">10</span>, <span class="fl">10.167</span>, <span class="fl">10.333</span>, <span class="fl">10.5</span>, <span class="fl">10.667</span>, <span class="fl">10.833</span>, <span class="fl">11</span>, <span class="fl">11.167</span>, <span class="fl">11.333</span>, <span class="fl">11.5</span>, <span class="fl">11.667</span>, <span class="fl">11.833</span>, <span class="fl">12</span>, <span class="fl">12.167</span>, <span class="fl">12.333</span>, <span class="fl">12.5</span>, <span class="fl">12.667</span>, <span class="fl">12.833</span>, <span class="fl">13</span>, <span class="fl">13.167</span>, <span class="fl">13.333</span>, <span class="fl">13.5</span>, <span class="fl">13.667</span>, <span class="fl">13.833</span>, <span class="fl">14</span>, <span class="fl">14.167</span>, <span class="fl">14.333</span>, <span class="fl">14.5</span>, <span class="fl">14.667</span>, <span class="fl">14.833</span>, <span class="fl">15</span>, <span class="fl">15.167</span>, <span class="fl">15.333</span>, <span class="fl">15.5</span>, <span class="fl">15.667</span>, <span class="fl">15.833</span>, <span class="fl">16</span>, <span class="fl">16.167</span>, <span class="fl">16.333</span>, <span class="fl">16.5</span>, <span class="fl">16.667</span>, <span class="fl">16.833</span>, <span class="fl">17</span>, <span class="fl">17.167</span>, <span class="fl">17.333</span>, <span class="fl">17.5</span>, <span class="fl">17.667</span>, <span class="fl">17.833</span>, <span class="fl">18</span>, <span class="fl">18.167</span>, <span class="fl">18.333</span>, <span class="fl">18.5</span>, <span class="fl">18.667</span>, <span class="fl">18.833</span>, <span class="fl">19</span>, <span class="fl">19.167</span>, <span class="fl">19.333</span>, <span class="fl">19.5</span>, <span class="fl">19.667</span>, <span class="fl">19.833</span>, <span class="fl">20</span>, <span class="fl">20.167</span>, <span class="fl">20.333</span>, <span class="fl">20.5</span>, <span class="fl">20.667</span>, <span class="fl">20.833</span>, <span class="fl">21</span>, <span class="fl">21.167</span>, <span class="fl">21.333</span>, <span class="fl">21.5</span>, <span class="fl">21.667</span>, <span class="fl">21.833</span>, <span class="fl">22</span>, <span class="fl">22.167</span>, <span class="fl">22.333</span>, <span class="fl">22.5</span>, <span class="fl">22.667</span>, <span class="fl">22.833</span>, <span class="fl">23</span>, <span class="fl">23.167</span>, <span class="fl">23.333</span>, <span class="fl">23.5</span>, <span class="fl">23.667</span>, <span class="fl">23.833</span>, <span class="fl">24</span><span class="op">)</span>, </span>
<span>  abundance <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.005</span>, <span class="fl">0.013</span>, <span class="fl">0.008</span>, <span class="fl">0.002</span>, <span class="fl">0.01</span>, <span class="fl">0.006</span>, <span class="fl">0.006</span>, <span class="fl">0.003</span>, <span class="fl">0.009</span>, <span class="fl">0.01</span>, <span class="fl">0.006</span>, <span class="fl">0.011</span>, <span class="fl">0</span>, <span class="fl">0.001</span>, <span class="fl">0.006</span>, <span class="fl">0.007</span>, <span class="fl">0.004</span>, <span class="fl">0.006</span>, <span class="fl">0.005</span>, <span class="fl">0.003</span>, <span class="fl">0.008</span>, <span class="fl">0.006</span>, <span class="fl">0.011</span>, <span class="fl">0.008</span>, <span class="fl">0.015</span>, <span class="fl">0.008</span>, <span class="fl">0.006</span>, <span class="fl">0.013</span>, <span class="fl">0.01</span>, <span class="fl">0.013</span>, <span class="fl">0.016</span>, <span class="fl">0.018</span>, <span class="fl">0.013</span>, <span class="fl">0.015</span>, <span class="fl">0.013</span>, <span class="fl">0.019</span>, <span class="fl">0.021</span>, <span class="fl">0.024</span>, <span class="fl">0.03</span>, <span class="fl">0.03</span>, <span class="fl">0.036</span>, <span class="fl">0.04</span>, <span class="fl">0.045</span>, <span class="fl">0.059</span>, <span class="fl">0.064</span>, <span class="fl">0.072</span>, <span class="fl">0.083</span>, <span class="fl">0.093</span>, <span class="fl">0.111</span>, <span class="fl">0.123</span>, <span class="fl">0.137</span>, <span class="fl">0.154</span>, <span class="fl">0.176</span>, <span class="fl">0.183</span>, <span class="fl">0.201</span>, <span class="fl">0.218</span>, <span class="fl">0.231</span>, <span class="fl">0.248</span>, <span class="fl">0.261</span>, <span class="fl">0.267</span>, <span class="fl">0.287</span>, <span class="fl">0.288</span>, <span class="fl">0.293</span>, <span class="fl">0.299</span>, <span class="fl">0.306</span>, <span class="fl">0.309</span>, <span class="fl">0.314</span>, <span class="fl">0.321</span>, <span class="fl">0.324</span>, <span class="fl">0.326</span>, <span class="fl">0.331</span>, <span class="fl">0.328</span>, <span class="fl">0.33</span>, <span class="fl">0.325</span>, <span class="fl">0.337</span>, <span class="fl">0.331</span>, <span class="fl">0.337</span>, <span class="fl">0.333</span>, <span class="fl">0.335</span>, <span class="fl">0.338</span>, <span class="fl">0.335</span>, <span class="fl">0.332</span>, <span class="fl">0.332</span>, <span class="fl">0.333</span>, <span class="fl">0.332</span>, <span class="fl">0.332</span>, <span class="fl">0.337</span>, <span class="fl">0.336</span>, <span class="fl">0.335</span>, <span class="fl">0.33</span>, <span class="fl">0.34</span>, <span class="fl">0.333</span>, <span class="fl">0.332</span>, <span class="fl">0.337</span>, <span class="fl">0.337</span>, <span class="fl">0.336</span>, <span class="fl">0.336</span>, <span class="fl">0.336</span>, <span class="fl">0.335</span>, <span class="fl">0.334</span>, <span class="fl">0.339</span>, <span class="fl">0.335</span>, <span class="fl">0.336</span>, <span class="fl">0.337</span>, <span class="fl">0.335</span>, <span class="fl">0.332</span>, <span class="fl">0.333</span>, <span class="fl">0.334</span>, <span class="fl">0.337</span>, <span class="fl">0.334</span>, <span class="fl">0.33</span>, <span class="fl">0.337</span>, <span class="fl">0.333</span>, <span class="fl">0.339</span>, <span class="fl">0.335</span>, <span class="fl">0.329</span>, <span class="fl">0.332</span>, <span class="fl">0.338</span>, <span class="fl">0.333</span>, <span class="fl">0.329</span>, <span class="fl">0.334</span>, <span class="fl">0.338</span>, <span class="fl">0.344</span>, <span class="fl">0.335</span>, <span class="fl">0.334</span>, <span class="fl">0.337</span>, <span class="fl">0.337</span>, <span class="fl">0.334</span>, <span class="fl">0.334</span>, <span class="fl">0.331</span>, <span class="fl">0.34</span>, <span class="fl">0.336</span>, <span class="fl">0.34</span>, <span class="fl">0.34</span>, <span class="fl">0.336</span>, <span class="fl">0.337</span>, <span class="fl">0.34</span>, <span class="fl">0.337</span>, <span class="fl">0.333</span>, <span class="fl">0.328</span>, <span class="fl">0.339</span>, <span class="fl">0.334</span>, <span class="fl">0.332</span>, <span class="fl">0.336</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Write a Stan program for the logistic growth model and estimate the
growth rate and carrying capacity for this <strong>E. coli</strong>
strain. Plot the marginal posteriors for <span class="math inline">\(P_0\)</span>, <span class="math inline">\(r\)</span> and <span class="math inline">\(K.\)</span> Generate a posterior of growth
trajectories and plot it against the data.</p>
</div>
</section><section id="mcmc"><h2 class="section-heading">MCMC<a class="anchor" aria-label="anchor" href="#mcmc"></a>
</h2>
<hr class="half-width"><div class="section level3">
<h3 id="medium-gibbs-sampler">(medium) Gibbs sampler<a class="anchor" aria-label="anchor" href="#medium-gibbs-sampler"></a></h3>
<p>Consider the distribution p(x, y) = exp{-(x<sup>2y</sup>2 + x^2 + y^2
-8x -8y)/2}/C, where C is a normalizing constant. It is known that the
conditional distribution of x given y is the normal distribution p(x|y)
= N(mu, sigma), where the mean mu = 4/(1 + y^2) and the standard
deviation sigma = sqrt(1/(1 + y^2)). Due to symmetry, p(y|x) can be
recovered simply by changing y’s to x’s in p(x|y).</p>
<p>The Gibbs sampler is a special case of the Metropolis-Hastings
algorithm. It can be stated as follows: 1) Choose some initial values
for the parameters. Let’s call them x_0 and y_0 in our case. 2) The
following samples are generated as follows: For i = 1, …, N: a) Draw x_i
from p(x|y_{i-1}) b) Draw y_i from p(y|x_i)</p>
<p>(In this notation x_i refers to the x sample at step i, y_{i-1} to
the y sample at step i-1 and so on)</p>
<p>Build a Gibbs sampler that draws samples from p(x, y). Visualize the
resulting distribution.</p>
</div>
<div class="section level3">
<h3 id="hard-metropolis-hastings-normal">(hard) Metropolis-Hastings: Normal<a class="anchor" aria-label="anchor" href="#hard-metropolis-hastings-normal"></a></h3>
<ol style="list-style-type: lower-alpha"><li><p>Generate data from the normal distribution. Implement a
Metropolis sampler for the normal model that estimates the mean and
variance. Use a normal distribution to generate the proposals.</p></li>
<li><p>Run 4 chains with distinct (e.g. random) initial values and plot
the chain’s trajectories in parameter space along with trace plots. How
does the proposal distribution’s variance affect the chains and the
resulting posterior samples?</p></li>
</ol><div class="section level4">
<h4 id="hint-2">Hint<a class="anchor" aria-label="anchor" href="#hint-2"></a></h4>
<p>See <a href="https://www.statisticshowto.com/metropolis-hastings-algorithm/" class="external-link uri">https://www.statisticshowto.com/metropolis-hastings-algorithm/</a>
for a description of Metropolis See Statistical Rethinking: Overthinking
box p.45 for a binomial example. Work with logarithms to avoid underflow
Think of what do to with negative proposals for the variance
parameter</p>
</div>
</div>
<div class="section level3">
<h3 id="hard-rhat">(hard) Rhat<a class="anchor" aria-label="anchor" href="#hard-rhat"></a></h3>
<p>Implement the <span class="math inline">\(\hat{R}\)</span> diagnostic
and compute it for posterior samples generated from some model (e.g. the
normal model of the previous exercise). Definition of the diagnostic can
be found in BDA3 p. 285.</p>
</div>
</section><section id="hierarchical-models"><h2 class="section-heading">Hierarchical models<a class="anchor" aria-label="anchor" href="#hierarchical-models"></a>
</h2>
<hr class="half-width"><div class="section level3">
<h3 id="easy-analyze-models">(easy) Analyze models<a class="anchor" aria-label="anchor" href="#easy-analyze-models"></a></h3>
<p>Are the following statistical models hierarchical? If not, make
modifications that turn them into hierarchical.</p>
<ol style="list-style-type: decimal"><li>
</li></ol><p><span class="math display">\[\begin{align}
  y_{group, i} &amp; \sim Normal(a_{group} + b x_{group, i}, \sigma) \\
  a_{group} &amp; \sim Normal(0, 1) \\
  b &amp; \sim Normal(0, 1) \\
  \sigma &amp; \sim Exponential(1)
\end{align}\]</span></p>
<ol start="2" style="list-style-type: decimal"><li>
</li></ol><p><span class="math display">\[\begin{align}
  y_i &amp;\sim Binomial(1, p_i) \\
  logit(p_i) &amp;= a_{group, i} + b x_i \\
  a_{group} &amp;\sim N(\alpha, 1) \\
  \alpha &amp;\sim N(0, 100) \\
  b &amp; \sim Normal(0, 1)
\end{align}\]</span></p>
<ol start="3" style="list-style-type: decimal"><li>
</li></ol><p><span class="math display">\[\begin{align}
  X_i &amp; \sim \Gamma(\alpha, \beta) \\
  \alpha &amp;\sim \Gamma(1, 1) \\
  \beta &amp;\sim \Gamma(1, 1) \\
\end{align}\]</span></p>
</div>
<div class="section level3">
<h3 id="medium-laborous-hierarchical-coin-analysis">(medium, laborous) Hierarchical coin analysis<a class="anchor" aria-label="anchor" href="#medium-laborous-hierarchical-coin-analysis"></a></h3>
<p>Estimate the fairness of a collection of coins. Fit pooled, unpooled
and partially pooled binomial models to the provided data. Generate a
figure that compares the posteriors. Plot also the population
distribution. What information does the population distribution
give?</p>
<p>Generate data</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Data</span></span>
<span><span class="va">G</span> <span class="op">&lt;-</span> <span class="fl">15</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu">rep</span><span class="op">(</span><span class="fl">25</span>, <span class="va">G</span><span class="op">)</span></span>
<span><span class="va">p_true</span> <span class="op">&lt;-</span> <span class="fu">rbeta</span><span class="op">(</span><span class="va">G</span>, <span class="fl">50</span>, <span class="fl">55</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">sort</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">rbinom</span><span class="op">(</span>n <span class="op">=</span> <span class="va">G</span>, size <span class="op">=</span> <span class="va">N</span>, prob <span class="op">=</span> <span class="va">p_true</span><span class="op">)</span></span></code></pre>
</div>
</div>
</section><section id="model-critisism"><h2 class="section-heading">Model critisism<a class="anchor" aria-label="anchor" href="#model-critisism"></a>
</h2>
<hr class="half-width"><div class="section level3">
<h3 id="easy-explanation-1">(easy) Explanation<a class="anchor" aria-label="anchor" href="#easy-explanation-1"></a></h3>
<p>Explain in your own words: a) the purpose of information criteria b)
log pointwise predictive distribution (lppd) c) what is the fundamental
difference between DIC/AIC and WAIC?</p>
</div>
<div class="section level3">
<h3 id="medium-posterior-predictive-check">(medium) Posterior predictive check<a class="anchor" aria-label="anchor" href="#medium-posterior-predictive-check"></a></h3>
<p>Build a Stan model that estimates the mean and standard deviation of
a normal distribution. Fit the model to the data in data1.txt and do a
posterior predictive check (for example a visual one). What are your
conclusions about the model’s suitability on this data based on the PPD?
What steps would you take next?</p>
<p>Hint: you can generate the PPD in R/Python or in the generated
quantities block in Stan</p>
</div>
<div class="section level3">
<h3 id="hard-waic-based-model-selection">(hard) WAIC-based model selection<a class="anchor" aria-label="anchor" href="#hard-waic-based-model-selection"></a></h3>
<p>Let us consider the polynomial regression models with 0 (intercept
only), 1 (linear regression), 2 (quadratic), 3 (cubic) degrees. Which of
these four models best describes the provided data in terms of the
WAIC?</p>
<p>Use the provided Stan models and implement the WAIC in R/Python.</p>
<p>Hint: See Statistical Rethinking p.220 for definition of WAIC and
Overthinking box on p.210. Can also be found in p. 173 in BDA3.</p>
<p>Data:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="op">-</span><span class="fl">0.54</span>, <span class="fl">0.72</span>, <span class="fl">1.12</span>, <span class="fl">0.57</span>, <span class="fl">0.61</span>, <span class="fl">0.89</span>, <span class="op">-</span><span class="fl">0.45</span>, <span class="fl">0.66</span>, <span class="fl">1.19</span>, <span class="op">-</span><span class="fl">1.26</span>, <span class="op">-</span><span class="fl">1.4</span>, <span class="fl">0.28</span>, <span class="op">-</span><span class="fl">0.42</span>, <span class="op">-</span><span class="fl">1.24</span>, <span class="fl">0.45</span>, <span class="fl">0.6</span>, <span class="op">-</span><span class="fl">0.92</span>, <span class="op">-</span><span class="fl">1.42</span>, <span class="fl">0.81</span>, <span class="op">-</span><span class="fl">0.41</span>, <span class="op">-</span><span class="fl">1.22</span>, <span class="fl">1.31</span>, <span class="op">-</span><span class="fl">0.38</span>, <span class="op">-</span><span class="fl">1.22</span>, <span class="op">-</span><span class="fl">1.02</span><span class="op">)</span></span>
<span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0.53</span>, <span class="fl">2.15</span>, <span class="fl">3.23</span>, <span class="fl">3.48</span>, <span class="fl">5.08</span>, <span class="fl">4.07</span>, <span class="fl">2.23</span>, <span class="fl">3.06</span>, <span class="fl">4.78</span>, <span class="fl">1.35</span>, <span class="fl">1.24</span>, <span class="fl">2.87</span>, <span class="fl">1.22</span>, <span class="op">-</span><span class="fl">0.48</span>, <span class="fl">3.48</span>, <span class="fl">4.03</span>, <span class="op">-</span><span class="fl">0.05</span>, <span class="op">-</span><span class="fl">0.19</span>, <span class="fl">2.31</span>, <span class="fl">0.96</span>, <span class="fl">1.14</span>, <span class="fl">6.85</span>, <span class="op">-</span><span class="fl">1.1</span>, <span class="op">-</span><span class="fl">1.32</span>, <span class="op">-</span><span class="fl">0.83</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span></code></pre>
</div>
<p>Stan programs:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">STAN<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode stan" tabindex="0"><code class="sourceCode stan"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">// intercept only</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span>{</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> N;</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] x;</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] y;</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span>{</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> a;</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma;</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span>{</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Likelihood</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  y ~ normal(a, sigma);</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Priors</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  a ~ normal(<span class="dv">0</span>, <span class="dv">1</span>);</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  sigma ~ gamma(<span class="dv">2</span>, <span class="dv">1</span>);</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>}</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">STAN<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode stan" tabindex="0"><code class="sourceCode stan"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">// linear</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span>{</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> N;</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] x;</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] y;</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span>{</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> a;</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> b;</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma;</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span>{</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Likelihood</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  y ~ normal(a + b*x, sigma);</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Priors</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  a ~ normal(<span class="dv">0</span>, <span class="dv">1</span>);</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  b ~ normal(<span class="dv">0</span>, <span class="dv">1</span>);</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  sigma ~ gamma(<span class="dv">2</span>, <span class="dv">1</span>);</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">STAN<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode stan" tabindex="0"><code class="sourceCode stan"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">// quadratic</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span>{</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> N;</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] x;</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] y;</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="kw">transformed data</span> {</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] x_sq;</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span>:N) x_sq[i] = x[i]*x[i];</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span>{</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> a;</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> b;</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> c;</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma;</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span>{</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Likelihood</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>  y ~ normal(a + b*x + c*x_sq, sigma);</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Priors</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>  a ~ normal(<span class="dv">0</span>, <span class="dv">1</span>);</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>  b ~ normal(<span class="dv">0</span>, <span class="dv">1</span>);</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>  c ~ normal(<span class="dv">0</span>, <span class="dv">1</span>);</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>  sigma ~ gamma(<span class="dv">2</span>, <span class="dv">1</span>);</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>}</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">STAN<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode stan" tabindex="0"><code class="sourceCode stan"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">// cubic</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span>{</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> N;</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] x;</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] y;</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="kw">transformed data</span> {</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] x_sq;</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] x_cu;</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span>:N) x_sq[i] = x[i]*x[i];</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span>:N) x_cu[i] = x_sq[i]*x[i];</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span>{</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> a;</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> b;</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> c;</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> d;</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma;</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span>{</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Likelihood</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>  y ~ normal(a + b*x + c*x_sq + d*x_cu, sigma);</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Priors</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>  a ~ normal(<span class="dv">0</span>, <span class="dv">1</span>);</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>  b ~ normal(<span class="dv">0</span>, <span class="dv">1</span>);</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>  c ~ normal(<span class="dv">0</span>, <span class="dv">1</span>);</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>  sigma ~ gamma(<span class="dv">2</span>, <span class="dv">1</span>);</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>}</span></code></pre>
</div>
</div>
</section><section id="other-topics"><h2 class="section-heading">Other topics<a class="anchor" aria-label="anchor" href="#other-topics"></a>
</h2>
<hr class="half-width"><div class="section level3">
<h3 id="hard-missing-observations-brownian-bridge">(hard) Missing observations: Brownian bridge<a class="anchor" aria-label="anchor" href="#hard-missing-observations-brownian-bridge"></a></h3>
<p>A time series is of length <span class="math inline">\(N=200\)</span>
is assumed to have been generated by the random walk process</p>
<p><span class="math display">\[x_t \sim N(x_{t-1}, \sigma^2).\]</span>
However, the observations at time points <span class="math inline">\(T=76, \ldots , 125\)</span> have been lost in a
fire.</p>
<p>Write a Stan program that estimates these missing values along with
the process variance <span class="math inline">\(\sigma^2.\)</span></p>
<p>Plot the time series and posterior draws for the missing values in
the same figure. Color the missing observations (that were not available
in the inference) in a different color.</p>
<p>Data can be simulated with the following piece of code:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Brownian bridge: random walk the a portion in missing values </span></span>
<span></span>
<span><span class="co"># Generate data</span></span>
<span><span class="va">N_obs_pre</span> <span class="op">&lt;-</span> <span class="fl">75</span></span>
<span><span class="va">N_mis</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">N_obs_post</span> <span class="op">&lt;-</span> <span class="fl">75</span></span>
<span></span>
<span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span></span>
<span><span class="va">y_full</span> <span class="op">&lt;-</span> <span class="fu">cumsum</span><span class="op">(</span><span class="fu">rnorm</span><span class="op">(</span><span class="va">N_obs_pre</span> <span class="op">+</span> <span class="va">N_mis</span> <span class="op">+</span> <span class="va">N_obs_post</span>, <span class="fl">0</span>, <span class="va">sigma</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y_full</span></span>
<span><span class="va">y</span><span class="op">[</span><span class="op">(</span><span class="va">N_obs_pre</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="va">N_obs_pre</span> <span class="op">+</span> <span class="va">N_mis</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul><li>Point</li>
</ul></div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/recommended-reading.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/index.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/recommended-reading.html" rel="prev"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous: further-materials</a>
        <a class="chapter-link float-end" href="../instructor/index.html" rel="next">Next... <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
				<p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/carpentries-incubator/statistical-probabilistic-programming-r/edit/main/episodes/exercises.Rmd" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/carpentries-incubator/statistical-probabilistic-programming-r/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a> 
        | <a href="https://github.com/carpentries-incubator/statistical-probabilistic-programming-r/" class="external-link">Source</a></p>
				<p><a href="https://github.com/carpentries-incubator/statistical-probabilistic-programming-r/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:velait@utu.fi">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="../LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p><a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">Template licensed under CC-BY 4.0</a> by <a href="https://carpentries.org" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.12.4" class="external-link">sandpaper (0.12.4)</a>,
        <a href="https://github.com/carpentries/pegboard" class="external-link">pegboard (0.5.3)</a>,
      and <a href="https://github.com/carpentries/varnish/tree/0.2.17" class="external-link">varnish (0.2.17)</a>.</p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
			<i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back to top"></i><br><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://carpentries-incubator.github.io/statistical-probabilistic-programming-r/instructor/exercises.html",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "exercises",
  "creativeWorkStatus": "active",
  "url": "https://carpentries-incubator.github.io/statistical-probabilistic-programming-r/instructor/exercises.html",
  "identifier": "https://carpentries-incubator.github.io/statistical-probabilistic-programming-r/instructor/exercises.html",
  "dateCreated": "2023-06-16",
  "dateModified": "2023-06-27",
  "datePublished": "2023-06-27"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

