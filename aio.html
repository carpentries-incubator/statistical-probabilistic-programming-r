<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Statistical and Probabilistic Programming: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="assets/styles.css">
<script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [ ['$','$'], ['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="manifest" href="site.webmanifest">
<link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav incubator"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Carpentries Incubator" src="assets/images/incubator-logo.svg"><abbr class="icon" title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught." style="text-decoration: unset">
           
          <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link" style="color: #383838">Pre-Alpha
            <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="color: #FF4955; border-radius: 5px"></i>
          </a>
          <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
        </abbr>
        
      </div>
    </div>
    <div class="selector-container ">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/aio.html';">Instructor View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Statistical and Probabilistic Programming
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
      <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Statistical and Probabilistic Programming
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
<input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset>
</form>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Statistical and Probabilistic Programming
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
  <div id="sidebar-col" class="col-lg-4">
    <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle"><i class="search-icon" data-feather="x" role="img"></i></button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/aio.html">Instructor View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->
      
            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="setup.html">1. Setup</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="bayesian-statistics.html">2. Bayesian Statistics</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="sampling.html">3. Working with samples</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="stan.html">4. Stan</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="mcmc.html">5. MCMC</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="hierarchical-models.html">6. Hierarchical Models</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="model-checking.html">7. Model checking</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="advanced-topics.html">8. Advanced topics</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width resources">
<a href="aio.html">See all in one page</a>

            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">
            
            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-setup"><p>Content from <a href="setup.html">Setup</a></p>
<hr>
<p> Last updated on 2023-05-26 | 
        
        <a href="https://github.com/carpentries-incubator/statistical-probabilistic-programming-r/edit/main/episodes/setup.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<p>FIXME: Setup instructions live in this document. Please specify the
tools and the data sets the Learner needs to have installed.</p>
<section id="data-sets"><h2 class="section-heading">Data Sets<a class="anchor" aria-label="anchor" href="#data-sets"></a>
</h2>
<hr class="half-width">
<!--
FIXME: place any data you want learners to use in `episodes/data` and then use
       a relative link ( [data zip file](data/lesson-data.zip) ) to provide a
       link to it, replacing the example.com link.
--><p>Download the <a href="https://example.com/FIXME" class="external-link">data zip file</a>
and unzip it to your Desktop</p>
</section><section id="software-setup"><h2 class="section-heading">Software Setup<a class="anchor" aria-label="anchor" href="#software-setup"></a>
</h2>
<hr class="half-width">
<div id="details" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="details" class="callout-inner">
<h3 class="callout-title">Details<a class="anchor" aria-label="anchor" href="#details"></a>
</h3>
<div class="callout-content">
<p>Setup for different systems can be presented in dropdown menus via a
<code>solution</code> tag. They will join to this discussion block, so
you can give a general overview of the software used in this lesson here
and fill out the individual operating systems (and potentially add more,
e.g. online setup) in the solutions blocks.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Windows
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>Use PuTTY</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  MacOS
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>Use Terminal.app</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Linux
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>Use Terminal</p>
</div>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-bayesian-statistics"><p>Content from <a href="bayesian-statistics.html">Bayesian Statistics</a></p>
<hr>
<p> Last updated on 2023-05-29 | 
        
        <a href="https://github.com/carpentries-incubator/statistical-probabilistic-programming-r/edit/main/episodes/bayesian-statistics.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is Bayesian statistics?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand the basic idea of Bayesian statistical thinking</li>
<li>Bayesian formula: prior, likelihood, posterior</li>
<li>Implement grid approximation for a Bayesian model</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="introduction"><h2 class="section-heading">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>The fundamental ingredient of Bayesian statistics and probabilistic
thinking is the Bayes’ theorem, stated as</p>
<p><span class="math display">\[
  p(\theta | X) = \frac{p(\theta)  p(X | \theta)}{p(X)} \\
\]</span></p>
<p>Given a statistical model, the theorem can be used to infer
probabilities of the values of the model parameters <span class="math inline">\(\theta\)</span> conditional on the available data
<span class="math inline">\(X\)</span>. These probabilities are
quantified by the <em>posterior distribution</em> <span class="math inline">\(p(\theta | X)\)</span>. The <em>prior
distribution</em> <span class="math inline">\(p(\theta)\)</span> is used
to impose beliefs about <span class="math inline">\(\theta\)</span>
without taking the data into account. The <em>likelihood function</em>
<span class="math inline">\(p(X | \theta)\)</span> gives the probability
of the data conditional <span class="math inline">\(\theta\)</span> and
specifies the effect of data on the posterior. The denominator on the
right-hand side <span class="math inline">\(p(X)\)</span> is called the
marginal probability, which is often practically impossible to compute,
and usually the proportional version of the Bayes’ formula is used:</p>
<p><span class="math display">\[
p(\theta | X) \propto p(\theta)  p(X | \theta).
\]</span></p>
<p>The proportional Bayes’ formula produces an unnormalized posterior
distribution which can then be normalized to access the normalized
posterior.</p>
</section><section id="example-handedness"><h2 class="section-heading">Example: handedness<a class="anchor" aria-label="anchor" href="#example-handedness"></a>
</h2>
<hr class="half-width">
<p>Let us illustrate the use of the Bayes’ theorem with an example.</p>
<p>Assume we are interested in estimating the prevalence of
left-handedness based on a sample of 50 children. In this sample 7
children reported left-handedness and 43 were right-handed. Since the
outcome is binary and the children independent (assumption) we can model
left-handedness with the binomial distribution:</p>
<p><span class="math display">\[
\text{Number of left-handed} \sim Bin(n, p)
\]</span></p>
<p>The parameters <span class="math inline">\(n\)</span> and <span class="math inline">\(p\)</span> refer to the total number of children
and proportion of the left-handed in the population, respectively. The
likelihood for the data is <span class="math inline">\(p(X|\theta) =
Bin(7 | 50, p).\)</span></p>
<p>Next, we should think what sort of prior information we’d like to
use. For instance, the following distributions might be considered:
<span class="math inline">\(Unif(0, 1); \, N(0, 1)\)</span> and <span class="math inline">\(Beta(1, 10)\)</span>.</p>
<div id="discussion1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Discussion<a class="anchor" aria-label="anchor" href="#discussion1"></a>
</h3>
<div class="callout-content">
<p>What could be the rationale for choosing each of these prior
distributions?</p>
</div>
</div>
</div>

<div class="section level3">
<h3 id="grid-approximation">Grid approximation<a class="anchor" aria-label="anchor" href="#grid-approximation"></a>
</h3>
<p>In many cases, analytical computations of the posterior are not
feasible and approximation methods need to be used. Although the
analytical posterior for the binomial model (with Beta prior) is
available, we’ll next illustrate fitting this model with a grid
approximation.</p>
<p>The grid approximation is a method for approximating the posterior
distribution. The idea is to discretize the parameter space into a grid
and then calculate the likelihood and prior at each grid point. The
product of these values forms the approximate unnormalized posterior. To
obtain a proper probability distribution, the unnormalized posterior is
then normalized by dividing each value by the sum of all values times
the discretization interval (in 1D, area in 2D etc.). This results in an
approximation of the posterior distribution.</p>
<p>In R, the model can be implemented as follows. First we define the
data variables:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sample size</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span></span>
<span><span class="co"># 7/50 are left-handed</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">7</span></span>
<span></span>
<span><span class="co"># Define a grid of points in the interval [0, 1], with 0.01 interval</span></span>
<span><span class="va">delta</span> <span class="op">&lt;-</span> <span class="fl">0.01</span></span>
<span><span class="va">p_grid</span> <span class="op">&lt;-</span> <span class="fu">seq</span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">1</span>, by <span class="op">=</span> <span class="va">delta</span><span class="op">)</span></span></code></pre>
</div>
<p>Next, we’ll define the likelihood, uniform prior and posterior
functions.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">likelihood</span> <span class="op">&lt;-</span> <span class="fu">dbinom</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, size <span class="op">=</span> <span class="va">N</span>, prob <span class="op">=</span> <span class="va">p_grid</span><span class="op">)</span></span>
<span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu">rep</span><span class="op">(</span><span class="fl">1</span>, <span class="fu">length</span><span class="op">(</span><span class="va">p_grid</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">posterior</span> <span class="op">&lt;-</span> <span class="va">likelihood</span><span class="op">*</span><span class="va">prior</span></span>
<span></span>
<span><span class="co"># normalize posterior</span></span>
<span><span class="va">posterior</span> <span class="op">&lt;-</span> <span class="va">posterior</span><span class="op">/</span><span class="op">(</span><span class="fu">sum</span><span class="op">(</span><span class="va">posterior</span><span class="op">)</span><span class="op">*</span><span class="va">delta</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make data frame</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span>p <span class="op">=</span> <span class="va">p_grid</span>, <span class="va">likelihood</span>, <span class="va">prior</span>, <span class="va">posterior</span><span class="op">)</span></span></code></pre>
</div>
<p>Finally, we can plot these functions</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># wide to long format</span></span>
<span><span class="va">df_l</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">gather</span><span class="op">(</span>key <span class="op">=</span> <span class="st">"func"</span>, value <span class="op">=</span> <span class="st">"value"</span>, <span class="op">-</span><span class="va">p</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">df_l</span>, </span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">p</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">func</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_grafify</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span></span></code></pre>
</div>
<figure><img src="fig/bayesian-statistics-rendered-unnamed-chunk-4-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Notice that the likelihood function is not a distribution in terms of
the parameter <span class="math inline">\(p\)</span>, so it doesn’t sum
to one. Below, we normalize it for better illustration.</p>
<p>Now that we have a posterior distribution (approximation) available,
we can try to quantify it by computing features of it. The mode (maximum
a posteriori, or MAP), average and variance and commonly employed point
estimates:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">data.frame</span><span class="op">(</span>Estimate <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Mode"</span>, <span class="st">"Mean"</span>, <span class="st">"Variance"</span><span class="op">)</span>, </span>
<span>           Value <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="fu">which.max</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">posterior</span><span class="op">)</span>, <span class="st">"p"</span><span class="op">]</span>,</span>
<span>                     <span class="fu">sum</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">p</span><span class="op">*</span><span class="va">df</span><span class="op">$</span><span class="va">posterior</span><span class="op">*</span><span class="va">delta</span><span class="op">)</span>, </span>
<span>                     <span class="fu">sum</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">p</span><span class="op">^</span><span class="fl">2</span><span class="op">*</span><span class="va">df</span><span class="op">$</span><span class="va">posterior</span><span class="op">*</span><span class="va">delta</span><span class="op">)</span> <span class="op">-</span> <span class="fu">sum</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">p</span><span class="op">*</span><span class="va">df</span><span class="op">$</span><span class="va">posterior</span><span class="op">*</span><span class="va">delta</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  Estimate      Value
1     Mode 0.14000000
2     Mean 0.15384615
3 Variance 0.00245618</code></pre>
</div>
<div id="discussion2" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Discussion<a class="anchor" aria-label="anchor" href="#discussion2"></a>
</h3>
<div class="callout-content">
<p>These are point estimates. What information do they give? What is
absent? Think of other ways in which you could quantify the posterior.
How could you quantify the uncertainty.</p>
<p>What is the conclusion of the analysis in terms of handedness?</p>
</div>
</div>
</div>

</div>
<div class="section level3">
<h3 id="effect-of-the-prior">Effect of the prior<a class="anchor" aria-label="anchor" href="#effect-of-the-prior"></a>
</h3>
<p>Next, let’s compare the effect of the prior, using the distributions
mentioned above.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uniform_prior</span> <span class="op">&lt;-</span> <span class="fu">dunif</span><span class="op">(</span>x <span class="op">=</span> <span class="va">p_grid</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">normal_prior</span> <span class="op">&lt;-</span> <span class="fu">dnorm</span><span class="op">(</span>x <span class="op">=</span> <span class="va">p_grid</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">beta_prior</span> <span class="op">&lt;-</span> <span class="fu">dbeta</span><span class="op">(</span>x <span class="op">=</span> <span class="va">p_grid</span>, shape1 <span class="op">=</span> <span class="fl">2</span>, shape2 <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">posterior1</span> <span class="op">&lt;-</span> <span class="va">likelihood</span><span class="op">*</span><span class="va">uniform_prior</span><span class="op">/</span><span class="op">(</span><span class="fu">sum</span><span class="op">(</span><span class="va">likelihood</span><span class="op">*</span><span class="va">uniform_prior</span><span class="op">)</span><span class="op">*</span><span class="va">delta</span><span class="op">)</span></span>
<span><span class="va">posterior2</span> <span class="op">&lt;-</span> <span class="va">likelihood</span><span class="op">*</span><span class="va">normal_prior</span><span class="op">/</span><span class="op">(</span><span class="fu">sum</span><span class="op">(</span><span class="va">likelihood</span><span class="op">*</span><span class="va">normal_prior</span><span class="op">)</span><span class="op">*</span><span class="va">delta</span><span class="op">)</span></span>
<span><span class="va">posterior3</span> <span class="op">&lt;-</span> <span class="va">likelihood</span><span class="op">*</span><span class="va">beta_prior</span><span class="op">/</span><span class="op">(</span><span class="fu">sum</span><span class="op">(</span><span class="va">likelihood</span><span class="op">*</span><span class="va">beta_prior</span><span class="op">)</span><span class="op">*</span><span class="va">delta</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Normalized likelihood</span></span>
<span><span class="va">likelihood</span> <span class="op">&lt;-</span> <span class="va">likelihood</span><span class="op">/</span><span class="op">(</span><span class="fu">sum</span><span class="op">(</span><span class="va">likelihood</span><span class="op">)</span><span class="op">*</span><span class="va">delta</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span>p <span class="op">=</span> <span class="fu">rep</span><span class="op">(</span><span class="va">p_grid</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>                  likelihood <span class="op">=</span> <span class="fu">rep</span><span class="op">(</span><span class="va">likelihood</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>                  prior <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="va">uniform_prior</span>,  <span class="va">normal_prior</span>, <span class="va">beta_prior</span><span class="op">)</span>, </span>
<span>                  posterior <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="va">posterior1</span>, <span class="va">posterior2</span>, <span class="va">posterior3</span><span class="op">)</span>, </span>
<span>                  prior_type <span class="op">=</span> <span class="fu">rep</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"uniform"</span>, <span class="st">"normal"</span>, <span class="st">"beta"</span><span class="op">)</span>,</span>
<span>                                   each <span class="op">=</span> <span class="fu">length</span><span class="op">(</span><span class="va">p_grid</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df2_w</span> <span class="op">&lt;-</span> <span class="va">df2</span> <span class="op">%&gt;%</span> <span class="fu">gather</span><span class="op">(</span>key <span class="op">=</span> <span class="st">"func"</span>, value <span class="op">=</span> <span class="st">"value"</span>, <span class="op">-</span><span class="fu">c</span><span class="op">(</span><span class="va">p</span>, <span class="va">prior_type</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span><span class="fu">ggplot</span><span class="op">(</span><span class="va">df2_w</span>,</span>
<span>         <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">p</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">func</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">prior_type</span>,</span>
<span>               scales <span class="op">=</span> <span class="st">"free"</span>, </span>
<span>               ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_grafify</span><span class="op">(</span><span class="op">)</span></span>
<span>    </span>
<span><span class="va">p2</span>    </span></code></pre>
</div>
<figure><img src="fig/bayesian-statistics-rendered-unnamed-chunk-6-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="discussion3" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#discussion3"></a>
</h3>
<div class="callout-content">
<p>Play around with the parameters of the prior distributions and see
how it affects the posterior.</p>
</div>
</div>
</div>
<p>The main limitation of the grid approximation method is that it
becomes impractical for models with a large number of parameters. The
reason is that the number of computations grows as <span class="math inline">\(O \{ n^p \}\)</span> where <span class="math inline">\(n\)</span> is the number of grid points per model
parameter and <span class="math inline">\(p\)</span> the number of
parameters. This quickly becomes prohibitive, and the grid approximation
is seldom used in practice. The standard approach to posterior
computations is to draw samples from it with Markov chain Monte Carlo
(MCMC) methods, which we will go through later. In the following
episodes, we will learn how to perform computations on samples drawn
from a distribution and eventually implement our own MCMC
algorithms.</p>
</div>
</section><section id="example-normal-model"><h2 class="section-heading">Example: normal model<a class="anchor" aria-label="anchor" href="#example-normal-model"></a>
</h2>
<hr class="half-width">
<p>Let us implement another standard statistical model, the normal
model, with the grid approximation. We’ll assume that the variance of
the model in known, <span class="math inline">\(\sigma^2=1,\)</span> and
we’d like to learn the mean parameter <span class="math inline">\(\mu.\)</span></p>
<p>Let us first generate some data from the model, 5 independent
observations from a normal distribution with unknown mean parameter:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sample size</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># Generate data</span></span>
<span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">unknown_mu</span> <span class="op">&lt;-</span> <span class="fu">runif</span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">rnorm</span><span class="op">(</span>n <span class="op">=</span> <span class="va">N</span>,</span>
<span>           mean <span class="op">=</span> <span class="va">unknown_mu</span>,</span>
<span>           sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span> </span>
<span></span>
<span></span>
<span><span class="co"># Define a grid of points for mu</span></span>
<span><span class="va">delta</span> <span class="op">&lt;-</span> <span class="fl">0.01</span></span>
<span><span class="va">mu_grid</span> <span class="op">&lt;-</span> <span class="fu">seq</span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">5</span>, to <span class="op">=</span> <span class="fl">5</span>, by <span class="op">=</span> <span class="va">delta</span><span class="op">)</span></span></code></pre>
</div>
<p>Similarly as before, we’ll then define the prior, likelihood, and
compute posterior distribution. We’ll use a normal prior with mean 0 and
standard deviation 1 for <span class="math inline">\(\mu\)</span>. As
the observations are assumed to be independent, the likelihood function
is product of the likelihoods of the individual points:</p>
<p><span class="math display">\[p(X | \theta) = \prod_{i = 1}^{N} p(X_i
| \theta),\]</span></p>
<p>where <span class="math inline">\(X_i\)</span> are individual data
points and <span class="math inline">\(N\)</span> the sample size.</p>
<p><span class="math display">\[\log p(X | \theta) = \sum_{i = 1}^{N}
\log p(X_i | \theta)\]</span></p>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge1"></a>
</h3>
<div class="callout-content">
<p>Implement the grid approximation the normal model with the generated
data as described above.</p>
<p>Work with logarithms to avoid underflow.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span>mu <span class="op">=</span> <span class="va">mu_grid</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Log likelihood</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu">nrow</span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># print(i)</span></span>
<span>  <span class="va">df</span><span class="op">[</span><span class="va">i</span>, <span class="st">"log_likelihood"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">sum</span><span class="op">(</span><span class="fu">dnorm</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>,</span>
<span>                                   mean <span class="op">=</span> <span class="va">df</span><span class="op">[</span><span class="va">i</span>, <span class="st">"mu"</span><span class="op">]</span>, sd <span class="op">=</span> <span class="va">sigma</span>,</span>
<span>                                   log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>likelihood <span class="op">=</span> <span class="fu">exp</span><span class="op">(</span><span class="va">log_likelihood</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prior: mu ~ N(0, 1)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>log_prior <span class="op">=</span> <span class="fu">dnorm</span><span class="op">(</span>x <span class="op">=</span> <span class="va">mu</span>,</span>
<span>                           mean <span class="op">=</span> <span class="fl">0</span> ,</span>
<span>                           sd <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                           log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>prior <span class="op">=</span> <span class="fu">exp</span><span class="op">(</span><span class="va">log_prior</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Posterior</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>log_posterior <span class="op">=</span> <span class="va">log_prior</span> <span class="op">+</span> <span class="va">log_likelihood</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>posterior <span class="op">=</span> <span class="fu">exp</span><span class="op">(</span><span class="va">log_posterior</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>posterior <span class="op">=</span> <span class="va">posterior</span><span class="op">/</span><span class="op">(</span><span class="fu">sum</span><span class="op">(</span><span class="va">posterior</span><span class="op">)</span><span class="op">*</span><span class="va">delta</span><span class="op">)</span><span class="op">)</span> <span class="co"># normalize</span></span>
<span></span>
<span><span class="co"># Normalize likelihood (for better illustration)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>likelihood <span class="op">=</span> <span class="va">likelihood</span><span class="op">/</span><span class="op">(</span><span class="fu">sum</span><span class="op">(</span><span class="va">likelihood</span><span class="op">)</span><span class="op">*</span><span class="va">delta</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Now, we can plot the prior, likelihood, and posterior, along with the
unknown true value of <span class="math inline">\(\mu\)</span> (black
vertical line).</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Wide --&gt; long format</span></span>
<span><span class="va">df_l</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">gather</span><span class="op">(</span>key <span class="op">=</span> <span class="st">"func"</span>, value <span class="op">=</span> <span class="st">"value"</span>, <span class="op">-</span><span class="fu">c</span><span class="op">(</span><span class="st">"mu"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># In log scale</span></span>
<span><span class="va">p_log</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">df_l</span> <span class="op">%&gt;%</span> </span>
<span>         <span class="fu">filter</span><span class="op">(</span><span class="fu">grepl</span><span class="op">(</span><span class="st">"log"</span>, <span class="va">func</span><span class="op">)</span><span class="op">)</span>, </span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">mu</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">func</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">unknown_mu</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># In regular scale</span></span>
<span><span class="va">p_reg</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">df_l</span> <span class="op">%&gt;%</span> </span>
<span>         <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">grepl</span><span class="op">(</span><span class="st">"log"</span>, <span class="va">func</span><span class="op">)</span><span class="op">)</span>, </span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">mu</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">func</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">unknown_mu</span>, </span>
<span>             color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_grafify</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_reg</span></span></code></pre>
</div>
<figure><img src="fig/bayesian-statistics-rendered-unnamed-chunk-9-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="discussion4" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Discussion<a class="anchor" aria-label="anchor" href="#discussion4"></a>
</h3>
<div class="callout-content">
<p>Play around with different samples sizes <span class="math inline">\(N\)</span> and priors for <span class="math inline">\(\mu\)</span> and see how the results change.</p>
<p>What happens if the true value of <span class="math inline">\(\mu\)</span> is not within the defined grid?</p>
</div>
</div>
</div>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge2"></a>
</h3>
<div class="callout-content">
<p>Implement the grid approximation with both unkown mean <span class="math inline">\(\mu\)</span> and standard deviation <span class="math inline">\(\sigma:\)</span></p>
<ol style="list-style-type: decimal">
<li>Generate data</li>
<li>Define grid for <span class="math inline">\(mu\)</span> and <span class="math inline">\(sigma\)</span>
</li>
<li>Compute prior, likelihood and posterior at grid points</li>
</ol>
<ul>
<li>Use normal and gamma priors for <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span>, respectively
<ul>
<li>The prior is the product of priors of <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span>
</li>
</ul>
</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Plot prior, likelihood and posterior (in 2D)</li>
<li>Compute marginal prior, likelihood and posterior for <span class="math inline">\(\mu\)</span>
</li>
</ol>
<ul>
<li>Marginalize (integrate) over sigma</li>
<li>Normalize</li>
<li>Plot</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>Included in the instructor’s notes.</p>
</div>
</div>
</div>
</div>

<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Likelihood determines the probability of data conditional on the
model parameters</li>
<li>Prior distribution encodes prior beliefs about the model
parameters</li>
<li>Posterior distribution quantifies the probability of parameter
values conditional on the data.</li>
<li>Posterior is a compromise between the data and prior. The less data
available, the bigger the effect of the prior.</li>
<li>The grid approximation is a means for accessing posterior
distributions which may be difficult to compute analytically</li>
</ul>
</div>
</div>
</div>
</section><section id="reading"><h2 class="section-heading">Reading<a class="anchor" aria-label="anchor" href="#reading"></a>
</h2>
<hr class="half-width">
<ul>
<li>Gelman <em>et al.</em>, Bayesian Data Analysis (3rd ed.): Ch. 1,
2</li>
<li>McElreath, Statistical Rethinking (2nd ed.): Ch. 2</li>
</ul>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 --></section></section><section id="aio-sampling"><p>Content from <a href="sampling.html">Working with samples</a></p>
<hr>
<p> Last updated on 2023-05-29 | 
        
        <a href="https://github.com/carpentries-incubator/statistical-probabilistic-programming-r/edit/main/episodes/sampling.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do you work with posterior samples?</li>
<li>How can the posterior information be handled?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn how to
<ul>
<li>work with posterior samples</li>
<li>compute posterior intervals</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>In the previous episode, we were introduced to the Bayesian formula
and learned how to fit binomial and normal models using the grid
approximation. However, the poor scalability of the grid approximation
makes it impractical to use on models of even moderate size. To overcome
this challenge, the standard solution is to employ Markov chain Monte
Carlo (MCMC) methods, which involve drawing random samples from the
posterior distribution. While we will delve into MCMC methods in
subsequent lessons, we will now learn working with samples.</p>
<section id="example-binomial-model"><h2 class="section-heading">Example: binomial model<a class="anchor" aria-label="anchor" href="#example-binomial-model"></a>
</h2>
<hr class="half-width">
<p>Let’s revisit the binomial model considered in the previous episode.
The binomial model with a beta distribution is an example of a model
where the analytical shape of the posterior is known.</p>
<p><span class="math display">\[p(\theta | X) = Beta(\alpha + x, \beta +
N - x),\]</span> where <span class="math inline">\(\alpha\)</span> and
<span class="math inline">\(\beta\)</span> are the hyperparameters and
<span class="math inline">\(x\)</span> the number of successes out of
<span class="math inline">\(N\)</span> trials.</p>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge1"></a>
</h3>
<div class="callout-content">
<p>Derive the analytical posterior distribution for the Beta-Binomial
model.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p><span class="math display">\[\begin{align}
p(\theta | X) &amp;\propto  p(X | \theta) p(\theta) \\
              &amp;= ...
\end{align}\]</span></p>
</div>
</div>
</div>
</div>
<p>Let’s generate samples from the prior and posterior distributions,
using the handedness data of the previous episode but first redefine the
data.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sample size</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span></span>
<span><span class="co"># 7/50 are left-handed</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">7</span></span></code></pre>
</div>
<p>In R, the standard statistical distributions can be sampled from
using readily available functions. For instance, the binomial, normal
and beta distributions can be sampled, respectively, with
<code>rbinom, rnorm</code> and <code>rbeta</code> functions. Let’s draw
5000 samples from the prior and posterior distributions.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Number of samples</span></span>
<span><span class="va">n_samples</span> <span class="op">&lt;-</span> <span class="fl">5000</span></span>
<span></span>
<span><span class="co"># Prior is Beta(1, 10)</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="co"># Draw random values from the prior</span></span>
<span><span class="va">prior_samples</span> <span class="op">&lt;-</span> <span class="fu">rbeta</span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_samples</span>,</span>
<span>                       shape1 <span class="op">=</span> <span class="va">alpha</span>,</span>
<span>                       shape2 <span class="op">=</span> <span class="va">beta</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Draw random values from the posterior</span></span>
<span><span class="va">posterior_samples</span> <span class="op">&lt;-</span> <span class="fu">rbeta</span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_samples</span>,</span>
<span>                           shape1 <span class="op">=</span> <span class="va">alpha</span> <span class="op">+</span> <span class="va">x</span>, </span>
<span>                           shape2 <span class="op">=</span> <span class="va">beta</span> <span class="op">+</span> <span class="va">N</span> <span class="op">-</span> <span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="va">samples_df</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span>prior <span class="op">=</span> <span class="va">prior_samples</span>, </span>
<span>                         posterior <span class="op">=</span> <span class="va">posterior_samples</span><span class="op">)</span></span></code></pre>
</div>
<p>Let’s plot histograms for these samples along with the analytical
densities, the normalized likelihood, and the “true” value (blue) based
on a larger population sample.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Wide --&gt; long format</span></span>
<span><span class="va">samples_df_w</span> <span class="op">&lt;-</span> <span class="va">samples_df</span> <span class="op">%&gt;%</span> <span class="fu">gather</span><span class="op">(</span>key <span class="op">=</span> <span class="st">"Samples"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define analytical distributions</span></span>
<span><span class="va">delta</span> <span class="op">&lt;-</span> <span class="fl">0.001</span></span>
<span><span class="va">analytical_df</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span>p <span class="op">=</span> <span class="fu">seq</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="va">delta</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    prior <span class="op">=</span> <span class="fu">dbeta</span><span class="op">(</span>x <span class="op">=</span> <span class="va">p</span> , <span class="va">alpha</span>, <span class="va">beta</span><span class="op">)</span>, </span>
<span>    posterior <span class="op">=</span> <span class="fu">dbeta</span><span class="op">(</span>x <span class="op">=</span> <span class="va">p</span> , <span class="va">alpha</span> <span class="op">+</span> <span class="va">x</span>, <span class="va">beta</span> <span class="op">+</span> <span class="va">N</span> <span class="op">-</span> <span class="va">x</span><span class="op">)</span>, </span>
<span>    likelihood <span class="op">=</span> <span class="fu">dbinom</span><span class="op">(</span>size <span class="op">=</span> <span class="va">N</span>, x <span class="op">=</span> <span class="va">x</span>, prob <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>likelihood <span class="op">=</span> <span class="va">likelihood</span><span class="op">/</span><span class="op">(</span><span class="fu">sum</span><span class="op">(</span><span class="va">likelihood</span><span class="op">)</span><span class="op">*</span><span class="va">delta</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># normalize likelihood for better presentation</span></span>
<span>  <span class="fu">gather</span><span class="op">(</span>key <span class="op">=</span> <span class="st">"Analytical function"</span>, value <span class="op">=</span> <span class="st">"value"</span>, <span class="op">-</span><span class="va">p</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># wide --&gt; long</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>`Analytical function` <span class="op">=</span> <span class="fu">factor</span><span class="op">(</span><span class="va">`Analytical function`</span>, levels <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"posterior"</span>, <span class="st">"prior"</span>, <span class="st">"likelihood"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Frequency in a large population sample (Hardyck, C. et al., 1976)</span></span>
<span><span class="va">p_true</span> <span class="op">&lt;-</span> <span class="fl">9.6</span><span class="op">/</span><span class="fl">100</span></span>
<span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">samples_df_w</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, y <span class="op">=</span> <span class="fu">after_stat</span><span class="op">(</span><span class="va">density</span><span class="op">)</span>,</span>
<span>                     fill <span class="op">=</span> <span class="va">Samples</span><span class="op">)</span>,</span>
<span>                 bins <span class="op">=</span> <span class="fl">50</span>, </span>
<span>                 position <span class="op">=</span> <span class="st">"identity"</span>, alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>data <span class="op">=</span> <span class="va">analytical_df</span>, </span>
<span>            <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">p</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">`Analytical function`</span><span class="op">)</span>, </span>
<span>            linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">p_true</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"blue"</span>, </span>
<span>             linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_grafify</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_fill_grafify</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"p"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/sampling-rendered-unnamed-chunk-4-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section id="posterior-intervals"><h2 class="section-heading">Posterior intervals<a class="anchor" aria-label="anchor" href="#posterior-intervals"></a>
</h2>
<hr class="half-width">
<p>In Episode 1, we summarized the posterior with the posterior mode
(MAP), mean and variance. While these points estimates are informative
and often utilized, they and not informative enough for many
scenarios.</p>
<p>More specified information about the posterior can be communicated
with <em>credible intervals</em> (CI). These intervals refer to areas of
the space where a certain amount of posterior mass is located. Usually
CIs are computed as quantiles of posterior, so for instance the 90% CI
would be located between the 5% and 95% percentiles.</p>
<p>Let us now compute the percentile-based CIs for the handedness
example, along with the posterior mode (MAP), and include them in the
figure. The x-axis is zoomed so for clarity.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># MAP</span></span>
<span><span class="va">posterior_density</span> <span class="op">&lt;-</span> <span class="fu">density</span><span class="op">(</span><span class="va">posterior_samples</span><span class="op">)</span></span>
<span><span class="va">MAP</span> <span class="op">&lt;-</span> <span class="va">posterior_density</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="fu">which.max</span><span class="op">(</span><span class="va">posterior_density</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># 90% credible interval</span></span>
<span><span class="va">CIs</span> <span class="op">&lt;-</span> <span class="fu">quantile</span><span class="op">(</span><span class="va">posterior_samples</span>, probs <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">CIs</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">MAP</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">p_true</span>, color <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Black = MAP and 90% CIs"</span><span class="op">)</span> </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.
This warning is displayed once every 8 hours.
Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
generated.</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">print</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/sampling-rendered-unnamed-chunk-5-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The 90% interval in this example is 0.07, 0.21 which means that,
according to the analysis, there is a 90% probability that the
proportion of left-handed people is between these values.</p>
<p>Another approach to reporting posterior information is to find the
amount of the posterior mass in a given interval (or some more general
set). This approach enables determining probabilities for hypotheses.
For instance, we might be interested in knowing the probability that the
target parameter is less than 0.2, between 0.05 and 0.10, or less than
0.1 or greater than 0.20. Such probabilities can be recovered based on
samples simply by computing the proportion of samples in these sets.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_less_than_0.15</span> <span class="op">&lt;-</span> <span class="fu">mean</span><span class="op">(</span><span class="va">posterior_samples</span> <span class="op">&lt;</span> <span class="fl">0.15</span><span class="op">)</span></span>
<span><span class="va">p_between_0.05_0.1</span> <span class="op">&lt;-</span> <span class="fu">mean</span><span class="op">(</span><span class="va">posterior_samples</span> <span class="op">&gt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">posterior_samples</span> <span class="op">&lt;</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">p_outside_0.1_0.2</span> <span class="op">&lt;-</span> <span class="fu">mean</span><span class="op">(</span><span class="va">posterior_samples</span> <span class="op">&lt;</span> <span class="fl">0.1</span> <span class="op">|</span> <span class="va">posterior_samples</span> <span class="op">&gt;</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre>
</div>
<p>Let’s visualize these probabilities as shaded areas of the analytical
posterior:</p>
<figure><img src="fig/sampling-rendered-unnamed-chunk-7-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="discussion1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Discussion<a class="anchor" aria-label="anchor" href="#discussion1"></a>
</h3>
<div class="callout-content">
<p>How would you compute CIs based on an analytical posterior
density?</p>
<p>Can you draw samples from the likelihood?</p>
</div>
</div>
</div>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge2"></a>
</h3>
<div class="callout-content">
<p>Another approach to posterior summarizing to compute the smallest
interval that contains p% of the posterior. Such sets are called highest
posterior density intervals (HPDI). More generally, this set can be a
more general set than an interval.</p>
<p>Write a function that returns the highest posterior density interval
based on a set of posterior samples. Compute the 95% HPDI for the
posterior samples generated (<code>samples_df</code>) and compare it to
the 95% CIs.</p>
</div>
</div>
</div>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1">
  Give me a hint
  </h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" aria-labelledby="headingHint1" data-bs-parent="#accordionHint1">
<div class="accordion-body">
<p>If you sort the posterior samples in order, each set of <span class="math inline">\(n\)</span> consecutive samples contains <span class="math inline">\(100 \cdot n/N \%\)</span> of the posterior, where
<span class="math inline">\(N\)</span> is the total number of
samples.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>Let’s write the function for computing the HPDI</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_HPDI</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">samples</span>, <span class="va">prob</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Total samples</span></span>
<span>  <span class="va">n_samples</span> <span class="op">&lt;-</span> <span class="fu">length</span><span class="op">(</span><span class="va">samples</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># How many samples constitute prob of the total number?</span></span>
<span>  <span class="va">prob_samples</span> <span class="op">&lt;-</span> <span class="fu">round</span><span class="op">(</span><span class="va">prob</span><span class="op">*</span><span class="va">n_samples</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Sort samples</span></span>
<span>  <span class="va">samples_sort</span> <span class="op">&lt;-</span> <span class="va">samples</span> <span class="op">%&gt;%</span> <span class="va">sort</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># Each samples_sort[i:(i + prob_samples - 1)] contains prob of the total distribution mass</span></span>
<span>  <span class="co"># Find the shortest such interval </span></span>
<span>  <span class="va">min_i</span> <span class="op">&lt;-</span> <span class="fu">lapply</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n_samples</span> <span class="op">-</span> <span class="va">prob_samples</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">samples_sort</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="va">prob_samples</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">samples_sort</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">unlist</span> <span class="op">%&gt;%</span> <span class="fu">which.min</span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Get correspongind values</span></span>
<span>  <span class="va">hpdi</span> <span class="op">&lt;-</span> <span class="va">samples_sort</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="va">min_i</span>, <span class="va">min_i</span> <span class="op">+</span> <span class="va">prob_samples</span><span class="op">)</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">hpdi</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>Then we can compute the 95% HPDI and compare it to the corresponding
CIs</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">data.frame</span><span class="op">(</span>HPDI <span class="op">=</span> <span class="fu">get_HPDI</span><span class="op">(</span><span class="va">samples_df</span><span class="op">$</span><span class="va">posterior</span>, <span class="fl">0.95</span><span class="op">)</span>, </span>
<span>           CI <span class="op">=</span> <span class="fu">quantile</span><span class="op">(</span><span class="va">posterior_samples</span>, probs <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="va">t</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">data.frame</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>length <span class="op">=</span> <span class="va">X97.5.</span> <span class="op">-</span> <span class="va">X2.5.</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>          X2.5.    X97.5.    length
HPDI 0.05376876 0.2159918 0.1622231
CI   0.05974777 0.2240324 0.1642846</code></pre>
</div>
<p>Both intervals contain the same mass but the HPDI is (slightly)
shorter.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>The posterior distribution can be summarized with point estimates or
computing the posterior mass in some set.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-stan"><p>Content from <a href="stan.html">Stan</a></p>
<hr>
<p> Last updated on 2023-05-26 | 
        
        <a href="https://github.com/carpentries-incubator/statistical-probabilistic-programming-r/edit/main/episodes/stan.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is Stan?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn how to use Stan</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="body"><h2 class="section-heading">Body<a class="anchor" aria-label="anchor" href="#body"></a>
</h2>
<hr class="half-width">
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>point 1</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-mcmc"><p>Content from <a href="mcmc.html">MCMC</a></p>
<hr>
<p> Last updated on 2023-05-26 | 
        
        <a href="https://github.com/carpentries-incubator/statistical-probabilistic-programming-r/edit/main/episodes/mcmc.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is MCMC?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li><p>Idea behind MCMC</p></li>
<li>
<p>Learn how to</p>
<ul>
<li>assess convergence</li>
<li>implement MCMC</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="body"><h2 class="section-heading">Body<a class="anchor" aria-label="anchor" href="#body"></a>
</h2>
<hr class="half-width">
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>point 1</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-hierarchical-models"><p>Content from <a href="hierarchical-models.html">Hierarchical Models</a></p>
<hr>
<p> Last updated on 2023-05-26 | 
        
        <a href="https://github.com/carpentries-incubator/statistical-probabilistic-programming-r/edit/main/episodes/hierarchical-models.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What are Bayesian hierarchical models?</li>
<li>What are they good for?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand the idea of hierarchical models</li>
<li>Learn how to build and with hierarchical models with Stan</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="body"><h2 class="section-heading">Body<a class="anchor" aria-label="anchor" href="#body"></a>
</h2>
<hr class="half-width">
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>point 1</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-model-checking"><p>Content from <a href="model-checking.html">Model checking</a></p>
<hr>
<p> Last updated on 2023-05-26 | 
        
        <a href="https://github.com/carpentries-incubator/statistical-probabilistic-programming-r/edit/main/episodes/model-checking.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is model checking?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn how assess model fit.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="body"><h2 class="section-heading">Body<a class="anchor" aria-label="anchor" href="#body"></a>
</h2>
<hr class="half-width">
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>point 1</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-advanced-topics"><p>Content from <a href="advanced-topics.html">Advanced topics</a></p>
<hr>
<p> Last updated on 2023-05-26 | 
        
        <a href="https://github.com/carpentries-incubator/statistical-probabilistic-programming-r/edit/main/episodes/advanced-topics.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is MCMC?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li><p>Idea behind MCMC</p></li>
<li>
<p>Learn how to</p>
<ul>
<li>assess convergence</li>
<li>implement MCMC</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="body"><h2 class="section-heading">Body<a class="anchor" aria-label="anchor" href="#body"></a>
</h2>
<hr class="half-width">
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>point 1</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
				<p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/carpentries-incubator/statistical-probabilistic-programming-r/edit/main/README.md" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/carpentries-incubator/statistical-probabilistic-programming-r/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a> 
        | <a href="https://github.com/carpentries-incubator/statistical-probabilistic-programming-r/" class="external-link">Source</a></p>
				<p><a href="https://github.com/carpentries-incubator/statistical-probabilistic-programming-r/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:velait@utu.fi">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p><a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">Template licensed under CC-BY 4.0</a> by <a href="https://carpentries.org" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper" class="external-link">sandpaper (0.12.1)</a>,
        <a href="https://github.com/carpentries/pegboard" class="external-link">pegboard (0.5.3)</a>,
      and <a href="https://github.com/carpentries/varnish/tree/0.2.17" class="external-link">varnish (0.2.17)</a>.</p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
			<i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back to top"></i><br><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://carpentries-incubator.github.io/statistical-probabilistic-programming-r/aio.html",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://carpentries-incubator.github.io/statistical-probabilistic-programming-r/aio.html",
  "identifier": "https://carpentries-incubator.github.io/statistical-probabilistic-programming-r/aio.html",
  "dateCreated": "2023-05-29",
  "dateModified": "2023-05-29",
  "datePublished": "2023-05-29"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code -->
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

